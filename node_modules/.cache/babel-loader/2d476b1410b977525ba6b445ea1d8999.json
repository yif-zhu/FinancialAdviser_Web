{"remainingRequest":"C:\\Users\\yif_z\\Desktop\\DealViewer\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\yif_z\\Desktop\\DealViewer\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!C:\\Users\\yif_z\\Desktop\\DealViewer\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\yif_z\\Desktop\\DealViewer\\src\\views\\admin\\ProductInformation.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\yif_z\\Desktop\\DealViewer\\src\\views\\admin\\ProductInformation.vue","mtime":1604281047458},{"path":"C:\\Users\\yif_z\\Desktop\\DealViewer\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\yif_z\\Desktop\\DealViewer\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\Users\\yif_z\\Desktop\\DealViewer\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\yif_z\\Desktop\\DealViewer\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport fsvc from \"@/api/FileService\";\nimport dynamicTab from \"@/mixins/dynamicTab.js\";\nimport Highcharts from \"highcharts\";\nimport TreeMap from \"highcharts/modules/treemap\";\nTreeMap(Highcharts); // import Dates from '@/components/product/Dates.vue'\n\nimport BaseInfo from \"@/components/common/BaseInfo.vue\";\nimport { mapState, mapMutations } from \"vuex\";\nimport { BasePath } from '@/utils/config.js';\nexport default {\n  data: function data() {\n    return {\n      stepTable: [],\n      tableHeight: \"auto\",\n      imgData: \"\",\n      structurePicture: \"\",\n      updateDialog: false,\n      progressSw: false,\n      percentage: 0,\n      progressText: \"正在保存文件，请稍等\",\n      dialogUploadFileName: \"\",\n      //上传文件名\n      PictureType: 0,\n      delFileType: 0,\n      CashFlowPicture: \"\",\n      CashFlowPicture2: \"\"\n    };\n  },\n  created: function created() {\n    this.loadDealStructure();\n  },\n  mixins: [dynamicTab],\n  components: {\n    BaseInfo: BaseInfo\n  },\n  computed: _objectSpread({\n    productDetail: function productDetail() {\n      var productDetail = JSON.parse(JSON.stringify(this.$store.state.productInfo.productDetail));\n      Object.keys(productDetail).forEach(function (key) {\n        if (productDetail[key] == \"\" || !productDetail[key]) {\n          productDetail[key] = \"-\";\n        }\n      });\n      return productDetail;\n    },\n    TrustID: function TrustID() {\n      return this.$store.state.productInfo.trustId;\n    }\n  }, mapState(\"user\", [\"userName\"])),\n  methods: _objectSpread(_objectSpread({}, mapMutations(\"dynamicTabs\", [\"setTab\"])), {}, {\n    loadDealStructure: function loadDealStructure() {\n      var self = this;\n      var svc = this.$http(\"PortfolioManagement\", \"DV.DealStructurePicture_Get\");\n      svc.AddParam({\n        Name: \"TrustID\",\n        Value: self.TrustID,\n        DBType: \"int\"\n      });\n      svc.ExecTable().then(function (res) {\n        console.log(res);\n        console.log(res[0]);\n        console.log(res[1]);\n\n        if (res.length > 0) {\n          var fileSource = res[0].FileSource;\n          var strCashFlowPicture = res[0].FileSource2;\n          var strCashFlowPicture2 = res[0].FileSource3;\n\n          if (fileSource) {\n            fileSource = fileSource.replace(/\\\\/g, \"/\");\n            self.structurePicture = BasePath + \"FileBaseFolder/\" + fileSource;\n          }\n\n          if (strCashFlowPicture) {\n            strCashFlowPicture = strCashFlowPicture.replace(/\\\\/g, \"/\");\n            self.CashFlowPicture = BasePath + \"FileBaseFolder/\" + strCashFlowPicture;\n          }\n\n          if (strCashFlowPicture2) {\n            strCashFlowPicture2 = strCashFlowPicture2.replace(/\\\\/g, \"/\");\n            self.CashFlowPicture2 = BasePath + \"FileBaseFolder/\" + strCashFlowPicture2;\n          }\n\n          return;\n        }\n\n        self.structurePicture = \"\";\n      });\n      self.setTab({\n        id: \"ProductDetail\" + self.TrustID,\n        name: \"ProductInformation\"\n      });\n    },\n    dialogFileInputs: function dialogFileInputs(event) {\n      var file = event.target.files;\n      var self = this;\n\n      if (file.length > 1) {\n        this.dialogUploadFileName = \"\";\n\n        for (var key in file) {\n          if (key == \"length\") {\n            self.dialogUploadFileName = self.dialogUploadFileName.substring(0, self.dialogUploadFileName.length - 1);\n            return;\n          }\n\n          self.dialogUploadFileName = self.dialogUploadFileName + file[key].name + \",\";\n        }\n      } else if (file.length == 1) {\n        this.dialogUploadFileName = file[0].name;\n      }\n    },\n    dialogUploadCilck: function dialogUploadCilck(id) {\n      $(\"#\" + id).click();\n    },\n    dealStructurePictureUpload: function dealStructurePictureUpload() {\n      var self = this;\n      var postData = $(\"#excelUploads\")[0].files;\n\n      if (postData.length < 1) {\n        self.$message.error(\"请选择上传的图片\");\n        return;\n      }\n\n      self.updateDialog = false;\n      var len = postData.length;\n      var ai = 0;\n      self.percentage = 0;\n      var postDataI = 0;\n      var nbprogress = 0;\n      var postDataName = postData[postDataI].name;\n      var folderName = \"DealViewer\\\\DealStructurePicture\\\\\" + self.TrustID;\n      folderName = this.PictureType == 1 ? \"DealViewer\\\\DealStructurePicture\\\\\" + self.TrustID + \"\\\\1\" : folderName;\n      folderName = this.PictureType == 2 ? \"DealViewer\\\\DealStructurePicture\\\\\" + self.TrustID + \"\\\\2\" : folderName;\n\n      var progress = function progress(progressEvt) {\n        self.progressSw = true;\n        nbprogress = progressEvt.loaded / progressEvt.total;\n        self.percentage = parseInt((postDataI + nbprogress) / postData.length * 100);\n      };\n\n      var callback1 = function callback1(fpath) {\n        self.progressText = \"\";\n        var filePath = fpath.UploadResult;\n        filePath = filePath.substr(0, filePath.lastIndexOf(\"\\\\\") + 1);\n        console.log(filePath);\n        var fileType = postDataName.substr(postDataName.lastIndexOf(\".\") + 1);\n        var svc = self.$http(\"PortfolioManagement\", \"DV.DealStructurePicture_Add\");\n        svc.AddParam({\n          Name: \"TrustId\",\n          Value: self.TrustID,\n          DBType: \"int\"\n        });\n        svc.AddParam({\n          Name: \"FilePath\",\n          Value: filePath,\n          DBType: \"string\"\n        });\n        svc.AddParam({\n          Name: \"FileName\",\n          Value: postDataName,\n          DBType: \"string\"\n        });\n        svc.AddParam({\n          Name: \"UserName\",\n          Value: self.userName,\n          DBType: \"string\"\n        });\n        svc.AddParam({\n          Name: \"PictureType\",\n          Value: self.PictureType,\n          DBType: \"string\"\n        });\n        svc.ExecResult().then(function (res) {\n          res = parseInt(res);\n\n          if (isNaN(res)) {\n            self.$message.success(\"文件上传成功\");\n            document.location.reload();\n            self.progressSw = false;\n          } else {\n            self.progressSw = true; // self.percentage = parseInt(((postDataI+1)/(postData.length)) * 100)\n\n            if (postDataI == postData.length - 1) {\n              self.progressText = \"已成功上传\" + (postDataI + 1) + \"个文件\";\n              setTimeout(function () {\n                self.progressSw = false;\n                self.progressText = \"\";\n              }, 500);\n            }\n\n            postDataI++;\n\n            if (postDataI < postData.length) {\n              postDataName = postData[postDataI].name;\n              fsvc.UploadOther(postData[postDataI], postDataName, folderName)(progress, callback1);\n            }\n\n            self.loadDealStructure();\n          }\n        });\n      };\n\n      var svc = self.$http(\"PortfolioManagement\", \"DV.DealStructurePicture_Remove\");\n      svc.AddParam({\n        Name: \"TrustID\",\n        Value: self.TrustID,\n        DBType: \"int\"\n      });\n      svc.AddParam({\n        Name: \"UserName\",\n        Value: self.userName,\n        DBType: \"string\"\n      });\n      svc.AddParam({\n        Name: \"PictureType\",\n        Value: self.PictureType,\n        DBType: \"string\"\n      });\n      svc.ExecResult().then(function (res) {\n        if (isNaN(res)) {\n          //self.$message.error('文件上传发生内部服务错误');\n          self.$message.success(\"文件上传成功\");\n          document.location.reload();\n        } else {\n          //删除物理文件\n          if (self.structurePicture) {\n            fsvc.Remove(self.structurePicture, 0);\n          }\n\n          fsvc.UploadOther(postData[postDataI], postDataName, folderName)(progress, callback1);\n        }\n      });\n    },\n    deleteFile: function deleteFile(ParamType) {\n      var self = this;\n      this.$confirm(\"图片将被删除,是否继续？\", \"提示\", {\n        confirmButtonText: \"确定\",\n        cancelButttonText: \"取消\",\n        type: \"warning\"\n      }).then(function () {\n        var svc = self.$http(\"PortfolioManagement\", \"DV.DealStructurePicture_Remove\");\n        svc.AddParam({\n          Name: \"TrustID\",\n          Value: self.TrustID,\n          DBType: \"int\"\n        });\n        svc.AddParam({\n          Name: \"UserName\",\n          Value: self.userName,\n          DBType: \"string\"\n        });\n        svc.AddParam({\n          Name: \"PictureType\",\n          Value: ParamType,\n          DBType: \"string\"\n        });\n        svc.ExecResult().then(function (res) {\n          if (isNaN(res)) {\n            self.$message.error(\"文件删除请求发生错误\");\n          } else {\n            self.$message.success(\"文件删除成功\"); //删除物理文件\n\n            if (self.structurePicture) {\n              fsvc.Remove(self.structurePicture, 0);\n            }\n\n            self.loadDealStructure();\n          }\n        });\n      }).catch(function () {});\n    },\n    clickupdateDialog: function clickupdateDialog() {\n      this.PictureType = 1;\n      this.updateDialog = true;\n    },\n    clickupdateDialog2: function clickupdateDialog2() {\n      this.PictureType = 2;\n      this.updateDialog = true;\n    }\n  }),\n  watch: {}\n};",{"version":3,"sources":["ProductInformation.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div class=\"productInformation detailPage\">\n    <div class=\"itemBox\">\n      <div class=\"table-title\">基本信息</div>\n      <div class=\"content\">\n        <el-row :gutter=\"20\">\n          <el-col :span=\"24\">\n            <BaseInfo :line=\"2\">\n              <li>\n                <span>产品名称</span>\n                <span>{{productDetail.TrustName}}</span>\n              </li>\n              <li>\n                <span>发行金额</span>\n                <span\n                  class=\"moneyMark\"\n                >{{productDetail.IssueAmount?productDetail.IssueAmount.toLocaleString():productDetail.IssueAmount}}</span>\n              </li>\n              <li>\n                <span>产品代码</span>\n                <span>{{productDetail.TrustCode}}</span>\n              </li>\n              <li>\n                <span>市场分类</span>\n                <span>{{productDetail.MarketCategoryName}}</span>\n              </li>\n              <li>\n                <span>发行时间</span>\n                <span class=\"otherMark\">{{productDetail.TrustStartDate}}</span>\n              </li>\n              <li>\n                <span>交易场所</span>\n                <span>{{productDetail.MarketPlaceName}}</span>\n              </li>\n              <li>\n                <span>资产类型</span>\n                <span>{{productDetail.AssetTypeName}}</span>\n              </li>\n              <li>\n                <span>监管机构</span>\n                <span>{{productDetail.RegulatoryOrgName}}</span>\n              </li>\n              <li>\n                <span>基本资产</span>\n                <span>{{productDetail.BasicAssetTypeName}}</span>\n              </li>\n              <li>\n                <span>发行方式</span>\n                <span>{{productDetail.CollectionMethodName}}</span>\n              </li>\n            </BaseInfo>\n          </el-col>\n        </el-row>\n      </div>\n    </div>\n    <div class=\"itemBox\">\n      <div>\n        <div style=\"float:right;margin-left: 10px;\">\n          <el-button type=\"primary\" size=\"mini\" @click=\"deleteFile(0)\">\n            <span class=\"iconfont icon-delete\"></span>删除图片\n          </el-button>\n        </div>\n        <div style=\"float:right;\">\n          <el-button type=\"primary\" size=\"mini\" @click=\"updateDialog = true\">\n            <span class=\"iconfont icon-upload1\"></span>上传图片\n          </el-button>\n        </div>\n\n        <div class=\"table-title\">交易结构</div>\n      </div>\n\n      <div class=\"content\" style=\"text-align:center;\">\n        <img :src=\"structurePicture\" style=\"width:60%;\" />\n        <p v-if=\"!structurePicture\" class=\"noData\">暂无数据</p>\n      </div>\n    </div>\n    <div class=\"itemBox\">\n      <div>\n        <div style=\"float:right;margin-left: 10px;\">\n          <el-button type=\"primary\" size=\"mini\" @click=\"deleteFile(1)\">\n            <span class=\"iconfont icon-delete\"></span>删除图片\n          </el-button>\n        </div>\n        <div style=\"float:right;\">\n          <el-button type=\"primary\" size=\"mini\" @click=\"clickupdateDialog()\">\n            <span class=\"iconfont icon-upload1\"></span>上传图片\n          </el-button>\n        </div>\n\n        <div class=\"table-title\">现金流分配顺序图——违约前</div>\n      </div>\n\n      <div class=\"content\" style=\"text-align:center;\">\n        <img :src=\"CashFlowPicture\" style=\"width:60%;\" />\n        <p v-if=\"!CashFlowPicture\" class=\"noData\">暂无数据</p>\n      </div>\n    </div>\n    <div class=\"itemBox\">\n      <div>\n        <div style=\"float:right;margin-left: 10px;\">\n          <el-button type=\"primary\" size=\"mini\" @click=\"deleteFile(2)\">\n            <span class=\"iconfont icon-delete\"></span>删除图片\n          </el-button>\n        </div>\n        <div style=\"float:right;\">\n          <el-button type=\"primary\" size=\"mini\" @click=\"clickupdateDialog2()\">\n            <span class=\"iconfont icon-upload1\"></span>上传图片\n          </el-button>\n        </div>\n\n        <div class=\"table-title\">现金流分配顺序图——违约后</div>\n      </div>\n\n      <div class=\"content\" style=\"text-align:center;\">\n        <img :src=\"CashFlowPicture2\" style=\"width:60%;\" />\n        <p v-if=\"!CashFlowPicture2\" class=\"noData\">暂无数据</p>\n      </div>\n    </div>\n    <base-dialog\n      :close-on-click-modal=\"false\"\n      title=\"上传文件\"\n      :visible.sync=\"updateDialog\"\n      width=\"500px\"\n      draggable\n    >\n      <div style=\"margin:20px 0;\">\n        <el-form ref=\"form\" autocomplete=\"off\" label-width=\"100px\" v-if=\"updateDialog\">\n          <el-form-item label=\"文件上传\">\n            <div class=\"dialogfileUploadBox\" style=\"margin:0;text-align:left;\">\n              <input\n                type=\"file\"\n                id=\"excelUploads\"\n                @change=\"dialogFileInputs($event)\"\n                class=\"fileUploadInput\"\n                accept=\"image/*\"\n              />\n              <el-input class=\"el_fileUploadInput\" v-model=\"dialogUploadFileName\" key=\"02\">\n                <el-button\n                  class=\"el_fileUploadBtn\"\n                  slot=\"append\"\n                  @click=\"dialogUploadCilck('excelUploads')\"\n                >选择文件</el-button>\n              </el-input>\n            </div>\n          </el-form-item>\n        </el-form>\n      </div>\n      <p style=\"text-align:center\">\n        <el-button @click=\"updateDialog = false\">取消</el-button>\n        <el-button type=\"primary\" @click=\"dealStructurePictureUpload()\" size=\"mini\">确定上传</el-button>\n      </p>\n    </base-dialog>\n    <!-- 进度条 -->\n    <div class=\"progressOut\" v-if=\"progressSw\">\n      <el-progress type=\"circle\" :percentage=\"percentage\" color=\"#8e71c7\" :width=\"90\"></el-progress>\n      <p\n        style=\"color:#333;position: absolute;top: 50%;width: 100%;text-align: center;font-size: 13px;margin-top:50px;\"\n      >{{progressText}}</p>\n    </div>\n  </div>\n</template>\n\n<script>\nimport fsvc from \"@/api/FileService\";\nimport dynamicTab from \"@/mixins/dynamicTab.js\";\nimport Highcharts from \"highcharts\";\nimport TreeMap from \"highcharts/modules/treemap\";\nTreeMap(Highcharts);\n// import Dates from '@/components/product/Dates.vue'\nimport BaseInfo from \"@/components/common/BaseInfo.vue\";\nimport { mapState, mapMutations } from \"vuex\";\nimport { BasePath } from '@/utils/config.js';\nexport default {\n  data() {\n    return {\n      stepTable: [],\n      tableHeight: \"auto\",\n      imgData: \"\",\n      structurePicture: \"\",\n      updateDialog: false,\n      progressSw: false,\n      percentage: 0,\n      progressText: \"正在保存文件，请稍等\",\n      dialogUploadFileName: \"\", //上传文件名\n      PictureType: 0,\n      delFileType: 0,\n      CashFlowPicture: \"\",\n      CashFlowPicture2: \"\"\n    };\n  },\n  created() {\n    this.loadDealStructure();\n  },\n  mixins: [dynamicTab],\n  components: {\n    BaseInfo\n  },\n  computed: {\n    productDetail() {\n      var productDetail = JSON.parse(\n        JSON.stringify(this.$store.state.productInfo.productDetail)\n      );\n\n      Object.keys(productDetail).forEach(key => {\n        if (productDetail[key] == \"\" || !productDetail[key]) {\n          productDetail[key] = \"-\";\n        }\n      });\n      return productDetail;\n    },\n    TrustID() {\n      return this.$store.state.productInfo.trustId;\n    },\n    ...mapState(\"user\", [\"userName\"])\n  },\n  methods: {\n    ...mapMutations(\"dynamicTabs\", [\"setTab\"]),\n    loadDealStructure() {\n      var self = this;\n      var svc = this.$http(\n        \"PortfolioManagement\",\n        \"DV.DealStructurePicture_Get\"\n      );\n      svc.AddParam({ Name: \"TrustID\", Value: self.TrustID, DBType: \"int\" });\n      svc.ExecTable().then(res => {\n        console.log(res);\n        console.log(res[0]);\n        console.log(res[1]);\n        if (res.length > 0) {\n          let fileSource = res[0].FileSource;\n          let strCashFlowPicture = res[0].FileSource2;\n          let strCashFlowPicture2 = res[0].FileSource3;\n          if (fileSource) {\n            fileSource = fileSource.replace(/\\\\/g, \"/\");\n            self.structurePicture = BasePath + \"FileBaseFolder/\" + fileSource;\n          }\n          if (strCashFlowPicture) {\n            strCashFlowPicture = strCashFlowPicture.replace(/\\\\/g, \"/\");\n            self.CashFlowPicture = BasePath + \"FileBaseFolder/\" + strCashFlowPicture;\n          }\n          if (strCashFlowPicture2) {\n            strCashFlowPicture2 = strCashFlowPicture2.replace(/\\\\/g, \"/\");\n            self.CashFlowPicture2 = BasePath + \"FileBaseFolder/\" + strCashFlowPicture2;\n          }\n\n          return;\n        }\n        self.structurePicture = \"\";\n      });\n      self.setTab({\n        id: \"ProductDetail\" + self.TrustID,\n        name: \"ProductInformation\"\n      });\n    },\n    dialogFileInputs(event) {\n      var file = event.target.files;\n      let self = this;\n      if (file.length > 1) {\n        this.dialogUploadFileName = \"\";\n        for (let key in file) {\n          if (key == \"length\") {\n            self.dialogUploadFileName = self.dialogUploadFileName.substring(\n              0,\n              self.dialogUploadFileName.length - 1\n            );\n            return;\n          }\n          self.dialogUploadFileName =\n            self.dialogUploadFileName + file[key].name + \",\";\n        }\n      } else if (file.length == 1) {\n        this.dialogUploadFileName = file[0].name;\n      }\n    },\n    dialogUploadCilck(id) {\n      $(\"#\" + id).click();\n    },\n    dealStructurePictureUpload() {\n      var self = this;\n      var postData = $(\"#excelUploads\")[0].files;\n      if (postData.length < 1) {\n        self.$message.error(\"请选择上传的图片\");\n        return;\n      }\n      self.updateDialog = false;\n      var len = postData.length;\n      var ai = 0;\n      self.percentage = 0;\n      var postDataI = 0;\n      var nbprogress = 0;\n      var postDataName = postData[postDataI].name;\n      var folderName = \"DealViewer\\\\DealStructurePicture\\\\\" + self.TrustID;\n      folderName =\n        this.PictureType == 1\n          ? \"DealViewer\\\\DealStructurePicture\\\\\" + self.TrustID + \"\\\\1\"\n          : folderName;\n      folderName =\n        this.PictureType == 2\n          ? \"DealViewer\\\\DealStructurePicture\\\\\" + self.TrustID + \"\\\\2\"\n          : folderName;\n      const progress = function(progressEvt) {\n        self.progressSw = true;\n        nbprogress = progressEvt.loaded / progressEvt.total;\n        self.percentage = parseInt(\n          ((postDataI + nbprogress) / postData.length) * 100\n        );\n      };\n      var callback1 = function(fpath) {\n        self.progressText = \"\";\n        let filePath = fpath.UploadResult;\n        filePath = filePath.substr(0, filePath.lastIndexOf(\"\\\\\") + 1);\n        console.log(filePath);\n        let fileType = postDataName.substr(postDataName.lastIndexOf(\".\") + 1);\n        var svc = self.$http(\n          \"PortfolioManagement\",\n          \"DV.DealStructurePicture_Add\"\n        );\n        svc.AddParam({\n          Name: \"TrustId\",\n          Value: self.TrustID,\n          DBType: \"int\"\n        });\n        svc.AddParam({\n          Name: \"FilePath\",\n          Value: filePath,\n          DBType: \"string\"\n        });\n        svc.AddParam({\n          Name: \"FileName\",\n          Value: postDataName,\n          DBType: \"string\"\n        });\n        svc.AddParam({\n          Name: \"UserName\",\n          Value: self.userName,\n          DBType: \"string\"\n        });\n        svc.AddParam({\n          Name: \"PictureType\",\n          Value: self.PictureType,\n          DBType: \"string\"\n        });\n        svc.ExecResult().then(res => {\n          res = parseInt(res);\n          if (isNaN(res)) {\n            self.$message.success(\"文件上传成功\");\n            document.location.reload();\n            self.progressSw = false;\n          } else {\n            self.progressSw = true;\n            // self.percentage = parseInt(((postDataI+1)/(postData.length)) * 100)\n            if (postDataI == postData.length - 1) {\n              self.progressText = \"已成功上传\" + (postDataI + 1) + \"个文件\";\n              setTimeout(() => {\n                self.progressSw = false;\n                self.progressText = \"\";\n              }, 500);\n            }\n            postDataI++;\n            if (postDataI < postData.length) {\n              postDataName = postData[postDataI].name;\n              fsvc.UploadOther(\n                postData[postDataI],\n                postDataName,\n                folderName\n              )(progress, callback1);\n            }\n            self.loadDealStructure();\n          }\n        });\n      };\n      var svc = self.$http(\n        \"PortfolioManagement\",\n        \"DV.DealStructurePicture_Remove\"\n      );\n      svc.AddParam({\n        Name: \"TrustID\",\n        Value: self.TrustID,\n        DBType: \"int\"\n      });\n      svc.AddParam({\n        Name: \"UserName\",\n        Value: self.userName,\n        DBType: \"string\"\n      });\n      svc.AddParam({\n        Name: \"PictureType\",\n        Value: self.PictureType,\n        DBType: \"string\"\n      });\n      svc.ExecResult().then(res => {\n        if (isNaN(res)) {\n          //self.$message.error('文件上传发生内部服务错误');\n          self.$message.success(\"文件上传成功\");\n          document.location.reload();\n        } else {\n          //删除物理文件\n          if (self.structurePicture) {\n            fsvc.Remove(self.structurePicture, 0);\n          }\n\n          fsvc.UploadOther(\n            postData[postDataI],\n            postDataName,\n            folderName\n          )(progress, callback1);\n        }\n      });\n    },\n    deleteFile(ParamType) {\n      var self = this;\n      this.$confirm(\"图片将被删除,是否继续？\", \"提示\", {\n        confirmButtonText: \"确定\",\n        cancelButttonText: \"取消\",\n        type: \"warning\"\n      })\n        .then(() => {\n          var svc = self.$http(\n            \"PortfolioManagement\",\n            \"DV.DealStructurePicture_Remove\"\n          );\n          svc.AddParam({\n            Name: \"TrustID\",\n            Value: self.TrustID,\n            DBType: \"int\"\n          });\n          svc.AddParam({\n            Name: \"UserName\",\n            Value: self.userName,\n            DBType: \"string\"\n          });\n          svc.AddParam({\n            Name: \"PictureType\",\n            Value: ParamType,\n            DBType: \"string\"\n          });\n          svc.ExecResult().then(res => {\n            if (isNaN(res)) {\n              self.$message.error(\"文件删除请求发生错误\");\n            } else {\n              self.$message.success(\"文件删除成功\");\n              //删除物理文件\n              if (self.structurePicture) {\n                fsvc.Remove(self.structurePicture, 0);\n              }\n              self.loadDealStructure();\n            }\n          });\n        })\n        .catch(() => {});\n    },\n    clickupdateDialog() {\n      this.PictureType = 1;\n      this.updateDialog = true;\n    },\n    clickupdateDialog2() {\n      this.PictureType = 2;\n      this.updateDialog = true;\n    }\n  },\n  watch: {}\n};\n</script>\n\n<style lang=\"scss\">\n.productInformation {\n  padding-top: 0;\n  .itemBox {\n    margin-bottom: 20px;\n    padding: 15px;\n    background-color: #fff;\n    p {\n      line-height: 30px;\n      span {\n        margin-right: 20px;\n        color: $--color-grey;\n      }\n    }\n    .content {\n      padding: 0 10px;\n    }\n    .moneyMark {\n      color: $--color-orange;\n      font-size: 15px;\n      font-weight: bold;\n    }\n    .otherMark {\n      font-size: 15px;\n      color: $--color-primary;\n      font-weight: bold;\n    }\n  }\n  .dialogfileUploadBox .el_fileUploadInput {\n    left: 0;\n    width: 300px;\n  }\n  .progressOut {\n    background-color: rgba(255, 255, 255, 0.7);\n    text-align: center;\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100vw;\n    height: 100vh;\n    z-index: 999;\n    .el-progress--circle {\n      top: 50%;\n      margin-top: -45px;\n      position: absolute;\n      left: 50%;\n      margin-left: -45px;\n    }\n  }\n}\n</style>\n"],"sourceRoot":"src/views/admin"}]}