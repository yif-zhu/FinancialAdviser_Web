{"remainingRequest":"C:\\Users\\yif_z\\Desktop\\DealViewer\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\yif_z\\Desktop\\DealViewer\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!C:\\Users\\yif_z\\Desktop\\DealViewer\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\yif_z\\Desktop\\DealViewer\\src\\components\\product\\RepaymentMatrix.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\yif_z\\Desktop\\DealViewer\\src\\components\\product\\RepaymentMatrix.vue","mtime":1604281046595},{"path":"C:\\Users\\yif_z\\Desktop\\DealViewer\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\yif_z\\Desktop\\DealViewer\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\Users\\yif_z\\Desktop\\DealViewer\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\yif_z\\Desktop\\DealViewer\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport utilsIndex from '@/utils/index.js';\nexport default {\n  name: \"RepaymentMatrix\",\n  props: {\n    data: {\n      type: Array,\n      default: function _default() {\n        return [];\n      }\n    }\n  },\n  data: function data() {\n    return {\n      layers: [],\n      computedLayers: [],\n      layeredInfoStyles: {\n        top: 0,\n        left: 0,\n        display: 'none'\n      },\n      layeredInfo: {\n        name: '',\n        offerAmount: '',\n        closingBalance: '',\n        closingBalanceRate: '',\n        remainingPercent: 0,\n        offerAmountPercent: 0\n      }\n    };\n  },\n  created: function created() {\n    this.initLayer();\n  },\n  methods: {\n    initLayer: function initLayer() {\n      var totalOfferAmount = 0;\n      this.data.forEach(function (v) {\n        console.log(v);\n        totalOfferAmount += parseFloat(v.OfferAmount);\n      });\n      var layers = {};\n      var layerColors = ['#759ae4', '#5566ce', '#01d5bf', '#00c673', '#bfd52a', '#f19603', '#a36fff'];\n      this.data.forEach(function (v, i) {\n        var offerAmount = v.OfferAmount ? parseFloat(v.OfferAmount) : 0;\n        var offerAmounts = v.OfferAmount ? utilsIndex.numUnit(v.OfferAmount) : 0;\n        var payAmount = v.PayAmount ? parseFloat(v.PayAmount) : 0;\n        var closingBalance = v.ClosingBalance ? utilsIndex.numUnit(v.ClosingBalance) : 0;\n        var closingBalanceRate = v.ClosingBalanceRate ? parseFloat(v.ClosingBalanceRate) : 0;\n        var payAmountPercent = payAmount / offerAmount * 100;\n        var offerAmountPercent = offerAmount / totalOfferAmount * 100;\n        var currentLayer = {\n          name: v.ShortName,\n          className: v.ClassName,\n          payAmountPercent: payAmountPercent,\n          payAmountStyle: {\n            height: payAmountPercent + '%'\n          },\n          offerAmountPercent: offerAmountPercent,\n          offerAmountStyle: {\n            width: '100%',\n            backgroundColor: layerColors[i]\n          },\n          text: (v.ClassName ? v.ClassName : '未知') + ' ' + Math.round(offerAmountPercent) + '%',\n          offerAmounts: offerAmounts,\n          closingBalance: closingBalance,\n          closingBalanceRate: closingBalanceRate,\n          remainingPercent: closingBalance / offerAmount,\n          value: offerAmount\n        };\n        if (!layers[v.ClassName]) layers[v.ClassName] = [];\n        layers[v.ClassName].push(currentLayer);\n      });\n      var computedLayers = [];\n      var freePercent = 100;\n\n      var fixedPercent = function fixedPercent(percent, freeCount) {\n        var o = 100 / 6;\n\n        if (percent <= o) {\n          freePercent -= o;\n          return o + '%';\n        }\n\n        if (percent === 100) return '100%';\n        var currentPercent = percent - percent % o;\n\n        if (freePercent <= currentPercent) {\n          return freePercent + '%';\n        } else {\n          freePercent -= currentPercent;\n\n          if (freeCount > 1) {\n            var needMinPercent = freeCount * o;\n\n            if (freePercent < needMinPercent) {\n              currentPercent = currentPercent - (needMinPercent - freePercent);\n              freePercent = freePercent + (needMinPercent - freePercent);\n            }\n          }\n\n          if (freePercent > o && freeCount === 1) {\n            var needFloatPercent = freePercent - o;\n            currentPercent += needFloatPercent;\n            freePercent += needFloatPercent;\n          }\n\n          return currentPercent + '%';\n        }\n      };\n\n      layers = Object.values(layers);\n      var totalCount = layers.length;\n      layers.forEach(function (layer, i) {\n        var count = layer.length;\n        var height = 0;\n\n        if (count > 1) {\n          var totalPercent = layer.map(function (v) {\n            return v.offerAmountPercent;\n          }).reduce(function (prev, next) {\n            return prev + next;\n          });\n          layer.forEach(function (v) {\n            v.offerAmountStyle.width = v.offerAmountPercent / totalPercent * 100 + '%';\n          });\n          height = totalPercent;\n        } else {\n          height = layer[0].offerAmountPercent;\n        }\n\n        computedLayers.push({\n          height: fixedPercent(height, totalCount - (i + 1)),\n          layer: layer,\n          backgroundColor: layerColors[i]\n        });\n      });\n      this.computedLayers = computedLayers;\n      this.layers = layers;\n    },\n    showInfo: function showInfo(event, item) {\n      //console.log(e)\n      var evt = event.target;\n      var actualLeft = evt.offsetLeft + evt.offsetWidth / 4;\n      var actualTop = evt.offsetTop + evt.offsetHeight / 2 + 10;\n      var current = evt.offsetParent;\n\n      while (current !== null && current !== this.$el) {\n        actualTop += current.offsetTop;\n        actualLeft += current.offsetLeft;\n        current = current.offsetParent;\n      }\n\n      if (actualLeft >= 130) {\n        actualLeft -= this.$el.offsetWidth - 130;\n      }\n\n      this.layeredInfoStyles = {\n        left: actualLeft + 'px',\n        top: actualTop + 'px',\n        display: 'block'\n      };\n      this.layeredInfo = item;\n    },\n    hideInfo: function hideInfo(event) {\n      //console.log('out', event)\n      var evt = event.toElement;\n\n      if (!this.$el.contains(evt)) {\n        this.layeredInfoStyles.display = 'none';\n      }\n    }\n  }\n};",{"version":3,"sources":["RepaymentMatrix.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwFA,OAAA,UAAA,MAAA,kBAAA;AACA,eAAA;AACA,EAAA,IAAA,EAAA,iBADA;AAEA,EAAA,KAAA,EAAA;AACA,IAAA,IAAA,EAAA;AACA,MAAA,IAAA,EAAA,KADA;AAEA,MAAA,OAAA,EAAA;AAAA,eAAA,EAAA;AAAA;AAFA;AADA,GAFA;AAQA,EAAA,IARA,kBAQA;AACA,WAAA;AACA,MAAA,MAAA,EAAA,EADA;AAEA,MAAA,cAAA,EAAA,EAFA;AAGA,MAAA,iBAAA,EAAA;AACA,QAAA,GAAA,EAAA,CADA;AAEA,QAAA,IAAA,EAAA,CAFA;AAGA,QAAA,OAAA,EAAA;AAHA,OAHA;AAQA,MAAA,WAAA,EAAA;AACA,QAAA,IAAA,EAAA,EADA;AAEA,QAAA,WAAA,EAAA,EAFA;AAGA,QAAA,cAAA,EAAA,EAHA;AAIA,QAAA,kBAAA,EAAA,EAJA;AAKA,QAAA,gBAAA,EAAA,CALA;AAMA,QAAA,kBAAA,EAAA;AANA;AARA,KAAA;AAiBA,GA1BA;AA2BA,EAAA,OA3BA,qBA2BA;AACA,SAAA,SAAA;AACA,GA7BA;AA8BA,EAAA,OAAA,EAAA;AACA,IAAA,SADA,uBACA;AACA,UAAA,gBAAA,GAAA,CAAA;AACA,WAAA,IAAA,CAAA,OAAA,CAAA,UAAA,CAAA,EAAA;AACA,QAAA,OAAA,CAAA,GAAA,CAAA,CAAA;AACA,QAAA,gBAAA,IAAA,UAAA,CAAA,CAAA,CAAA,WAAA,CAAA;AACA,OAHA;AAKA,UAAA,MAAA,GAAA,EAAA;AACA,UAAA,WAAA,GAAA,CACA,SADA,EAEA,SAFA,EAGA,SAHA,EAIA,SAJA,EAKA,SALA,EAMA,SANA,EAOA,SAPA,CAAA;AASA,WAAA,IAAA,CAAA,OAAA,CAAA,UAAA,CAAA,EAAA,CAAA,EAAA;AACA,YAAA,WAAA,GAAA,CAAA,CAAA,WAAA,GAAA,UAAA,CAAA,CAAA,CAAA,WAAA,CAAA,GAAA,CAAA;AACA,YAAA,YAAA,GAAA,CAAA,CAAA,WAAA,GAAA,UAAA,CAAA,OAAA,CAAA,CAAA,CAAA,WAAA,CAAA,GAAA,CAAA;AACA,YAAA,SAAA,GAAA,CAAA,CAAA,SAAA,GAAA,UAAA,CAAA,CAAA,CAAA,SAAA,CAAA,GAAA,CAAA;AACA,YAAA,cAAA,GAAA,CAAA,CAAA,cAAA,GAAA,UAAA,CAAA,OAAA,CAAA,CAAA,CAAA,cAAA,CAAA,GAAA,CAAA;AACA,YAAA,kBAAA,GAAA,CAAA,CAAA,kBAAA,GAAA,UAAA,CAAA,CAAA,CAAA,kBAAA,CAAA,GAAA,CAAA;AACA,YAAA,gBAAA,GAAA,SAAA,GAAA,WAAA,GAAA,GAAA;AACA,YAAA,kBAAA,GAAA,WAAA,GAAA,gBAAA,GAAA,GAAA;AACA,YAAA,YAAA,GAAA;AACA,UAAA,IAAA,EAAA,CAAA,CAAA,SADA;AAEA,UAAA,SAAA,EAAA,CAAA,CAAA,SAFA;AAGA,UAAA,gBAAA,EAAA,gBAHA;AAIA,UAAA,cAAA,EAAA;AACA,YAAA,MAAA,EAAA,gBAAA,GAAA;AADA,WAJA;AAOA,UAAA,kBAAA,EAAA,kBAPA;AAQA,UAAA,gBAAA,EAAA;AACA,YAAA,KAAA,EAAA,MADA;AAEA,YAAA,eAAA,EAAA,WAAA,CAAA,CAAA;AAFA,WARA;AAYA,UAAA,IAAA,EAAA,CAAA,CAAA,CAAA,SAAA,GAAA,CAAA,CAAA,SAAA,GAAA,IAAA,IAAA,GAAA,GAAA,IAAA,CAAA,KAAA,CAAA,kBAAA,CAAA,GAAA,GAZA;AAaA,UAAA,YAAA,EAAA,YAbA;AAcA,UAAA,cAAA,EAAA,cAdA;AAeA,UAAA,kBAAA,EAAA,kBAfA;AAgBA,UAAA,gBAAA,EAAA,cAAA,GAAA,WAhBA;AAiBA,UAAA,KAAA,EAAA;AAjBA,SAAA;AAoBA,YAAA,CAAA,MAAA,CAAA,CAAA,CAAA,SAAA,CAAA,EAAA,MAAA,CAAA,CAAA,CAAA,SAAA,CAAA,GAAA,EAAA;AAEA,QAAA,MAAA,CAAA,CAAA,CAAA,SAAA,CAAA,CAAA,IAAA,CAAA,YAAA;AAEA,OAhCA;AAkCA,UAAA,cAAA,GAAA,EAAA;AAEA,UAAA,WAAA,GAAA,GAAA;;AAEA,UAAA,YAAA,GAAA,SAAA,YAAA,CAAA,OAAA,EAAA,SAAA,EAAA;AACA,YAAA,CAAA,GAAA,MAAA,CAAA;;AACA,YAAA,OAAA,IAAA,CAAA,EAAA;AACA,UAAA,WAAA,IAAA,CAAA;AACA,iBAAA,CAAA,GAAA,GAAA;AACA;;AACA,YAAA,OAAA,KAAA,GAAA,EAAA,OAAA,MAAA;AACA,YAAA,cAAA,GAAA,OAAA,GAAA,OAAA,GAAA,CAAA;;AACA,YAAA,WAAA,IAAA,cAAA,EAAA;AACA,iBAAA,WAAA,GAAA,GAAA;AACA,SAFA,MAEA;AAEA,UAAA,WAAA,IAAA,cAAA;;AACA,cAAA,SAAA,GAAA,CAAA,EAAA;AACA,gBAAA,cAAA,GAAA,SAAA,GAAA,CAAA;;AACA,gBAAA,WAAA,GAAA,cAAA,EAAA;AACA,cAAA,cAAA,GAAA,cAAA,IAAA,cAAA,GAAA,WAAA,CAAA;AACA,cAAA,WAAA,GAAA,WAAA,IAAA,cAAA,GAAA,WAAA,CAAA;AACA;AACA;;AACA,cAAA,WAAA,GAAA,CAAA,IAAA,SAAA,KAAA,CAAA,EAAA;AACA,gBAAA,gBAAA,GAAA,WAAA,GAAA,CAAA;AACA,YAAA,cAAA,IAAA,gBAAA;AACA,YAAA,WAAA,IAAA,gBAAA;AACA;;AACA,iBAAA,cAAA,GAAA,GAAA;AACA;AACA,OA3BA;;AA6BA,MAAA,MAAA,GAAA,MAAA,CAAA,MAAA,CAAA,MAAA,CAAA;AAEA,UAAA,UAAA,GAAA,MAAA,CAAA,MAAA;AAIA,MAAA,MAAA,CAAA,OAAA,CAAA,UAAA,KAAA,EAAA,CAAA,EAAA;AACA,YAAA,KAAA,GAAA,KAAA,CAAA,MAAA;AACA,YAAA,MAAA,GAAA,CAAA;;AACA,YAAA,KAAA,GAAA,CAAA,EAAA;AACA,cAAA,YAAA,GAAA,KAAA,CAAA,GAAA,CAAA,UAAA,CAAA;AAAA,mBAAA,CAAA,CAAA,kBAAA;AAAA,WAAA,EAAA,MAAA,CAAA,UAAA,IAAA,EAAA,IAAA;AAAA,mBAAA,IAAA,GAAA,IAAA;AAAA,WAAA,CAAA;AACA,UAAA,KAAA,CAAA,OAAA,CAAA,UAAA,CAAA,EAAA;AACA,YAAA,CAAA,CAAA,gBAAA,CAAA,KAAA,GAAA,CAAA,CAAA,kBAAA,GAAA,YAAA,GAAA,GAAA,GAAA,GAAA;AACA,WAFA;AAGA,UAAA,MAAA,GAAA,YAAA;AACA,SANA,MAMA;AACA,UAAA,MAAA,GAAA,KAAA,CAAA,CAAA,CAAA,CAAA,kBAAA;AACA;;AACA,QAAA,cAAA,CAAA,IAAA,CAAA;AACA,UAAA,MAAA,EAAA,YAAA,CAAA,MAAA,EAAA,UAAA,IAAA,CAAA,GAAA,CAAA,CAAA,CADA;AAEA,UAAA,KAAA,EAAA,KAFA;AAGA,UAAA,eAAA,EAAA,WAAA,CAAA,CAAA;AAHA,SAAA;AAKA,OAjBA;AAkBA,WAAA,cAAA,GAAA,cAAA;AACA,WAAA,MAAA,GAAA,MAAA;AACA,KA/GA;AAgHA,IAAA,QAhHA,oBAgHA,KAhHA,EAgHA,IAhHA,EAgHA;AACA;AACA,UAAA,GAAA,GAAA,KAAA,CAAA,MAAA;AACA,UAAA,UAAA,GAAA,GAAA,CAAA,UAAA,GAAA,GAAA,CAAA,WAAA,GAAA,CAAA;AACA,UAAA,SAAA,GAAA,GAAA,CAAA,SAAA,GAAA,GAAA,CAAA,YAAA,GAAA,CAAA,GAAA,EAAA;AACA,UAAA,OAAA,GAAA,GAAA,CAAA,YAAA;;AACA,aAAA,OAAA,KAAA,IAAA,IAAA,OAAA,KAAA,KAAA,GAAA,EAAA;AACA,QAAA,SAAA,IAAA,OAAA,CAAA,SAAA;AACA,QAAA,UAAA,IAAA,OAAA,CAAA,UAAA;AACA,QAAA,OAAA,GAAA,OAAA,CAAA,YAAA;AACA;;AAEA,UAAA,UAAA,IAAA,GAAA,EAAA;AACA,QAAA,UAAA,IAAA,KAAA,GAAA,CAAA,WAAA,GAAA,GAAA;AACA;;AACA,WAAA,iBAAA,GAAA;AACA,QAAA,IAAA,EAAA,UAAA,GAAA,IADA;AAEA,QAAA,GAAA,EAAA,SAAA,GAAA,IAFA;AAGA,QAAA,OAAA,EAAA;AAHA,OAAA;AAKA,WAAA,WAAA,GAAA,IAAA;AACA,KArIA;AAsIA,IAAA,QAtIA,oBAsIA,KAtIA,EAsIA;AACA;AACA,UAAA,GAAA,GAAA,KAAA,CAAA,SAAA;;AACA,UAAA,CAAA,KAAA,GAAA,CAAA,QAAA,CAAA,GAAA,CAAA,EAAA;AACA,aAAA,iBAAA,CAAA,OAAA,GAAA,MAAA;AACA;AACA;AA5IA;AA9BA,CAAA","sourcesContent":["<style lang=\"scss\" scoped>\n  .repayment-matrix{\n    position: relative;\n    width: 250px;\n    height: 160px;\n    margin-bottom: 10px;\n    display: inline-block;\n    .layered-container{\n      display: flex;\n      flex-direction: column;\n\n      &.is-horizontal{\n        flex-direction: row;\n      }\n    }\n\n    .layered{\n      position: relative;\n      border: 1px solid #fff;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      overflow: hidden;\n      height: 100%;\n      font-size: 12px;\n      color: #fff;\n      text-align: center;\n\n      .layered-used-space{\n        position: absolute;\n        top: 0;\n        right: 0;\n        left: 0;\n        opacity: 1;\n        pointer-events: none;\n        background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAGCAYAAAD37n+BAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAF8WlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDAgNzkuMTYwNDUxLCAyMDE3LzA1LzA2LTAxOjA4OjIxICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgKE1hY2ludG9zaCkiIHhtcDpDcmVhdGVEYXRlPSIyMDE4LTA2LTEzVDEzOjQ4OjU3KzA4OjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAxOC0wNi0xM1QxNDoxNDozNyswODowMCIgeG1wOk1ldGFkYXRhRGF0ZT0iMjAxOC0wNi0xM1QxNDoxNDozNyswODowMCIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiIHBob3Rvc2hvcDpJQ0NQcm9maWxlPSJzUkdCIElFQzYxOTY2LTIuMSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDoyZGIxNzU5NC05OWVmLTRjZTEtOWRkMi1iNTIwZmM0OTAyOTEiIHhtcE1NOkRvY3VtZW50SUQ9ImFkb2JlOmRvY2lkOnBob3Rvc2hvcDo2NDliNzgyMC0yOGUxLTIyNDctOWMxOS1jMTI3YTQwNmJlZDUiIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDowZjIwZWFmMC01NDExLTQ4NmQtYWYxYS1lZTI4NzM3ZjQ1ODYiPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJjcmVhdGVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjBmMjBlYWYwLTU0MTEtNDg2ZC1hZjFhLWVlMjg3MzdmNDU4NiIgc3RFdnQ6d2hlbj0iMjAxOC0wNi0xM1QxMzo0ODo1NyswODowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIENDIChNYWNpbnRvc2gpIi8+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJzYXZlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDoyZGIxNzU5NC05OWVmLTRjZTEtOWRkMi1iNTIwZmM0OTAyOTEiIHN0RXZ0OndoZW49IjIwMTgtMDYtMTNUMTQ6MTQ6MzcrMDg6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCBDQyAoTWFjaW50b3NoKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8L3JkZjpTZXE+IDwveG1wTU06SGlzdG9yeT4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz7e4M9IAAAAKElEQVQYlWP8//8/AxQ0oNFYxZkYSAQsxJoMAyTbwIjkB7wmM5DrBwBqHAuHsM3a0gAAAABJRU5ErkJggg==) repeat;\n      }\n    }\n\n    .layered-info{\n      position: absolute;\n      width: 130px;\n      padding: 5px;\n      background-color: #fff;\n      font-size: 12px;\n      line-height: 1.77;\n      color: #555;\n      z-index: 9999;\n      box-shadow: 0 0 3px 0 rgba(0, 0, 0, .2);\n      \n      p {\n        span{\n          color: #999;\n          margin-right: 3px;\n        }\n      }\n    }\n  }\n</style>\n\n<template>\n  <div class=\"repayment-matrix\">\n    <div v-for=\"(con, i) in computedLayers\"\n         class=\"layered-container\"\n         :class=\"{'is-horizontal': con.layer.length > 1}\"\n         :style=\"{height: con.height, backgroundColor: con.backgroundColor}\"\n         :key=\"i\">\n      <div class=\"layered\"\n           v-for=\"(item, index) in con.layer\"\n           :style=\"item.offerAmountStyle\"\n           @mouseover=\"showInfo($event, item)\"\n           @mouseout=\"hideInfo\"\n           :key=\"index\">\n        <div class=\"layered-used-space\" :style=\"item.payAmountStyle\"></div>\n        <!-- {{item.text}} -->\n      </div>\n    </div>\n    <div class=\"layered-info\" :style=\"layeredInfoStyles\">\n      <p><span>证券简称</span>{{layeredInfo.name}}</p>\n      <p><span>分层占比</span>{{layeredInfo.offerAmountPercent.toFixed(2)}}%</p>\n      <p><span>初始本金</span>{{layeredInfo.offerAmounts}}</p>\n      <p><span>剩余本金</span>{{layeredInfo.closingBalance}}</p>\n      <p><span>剩余占比</span>{{layeredInfo.closingBalanceRate}}%</p>\n    </div>\n  </div>\n</template>\n\n<script>\n  import utilsIndex from '@/utils/index.js'\n  export default {\n    name: \"RepaymentMatrix\",\n    props: {\n      data: {\n        type: Array,\n        default: () => []\n      }\n    },\n    data() {\n      return {\n        layers: [],\n        computedLayers: [],\n        layeredInfoStyles: {\n          top: 0,\n          left: 0,\n          display: 'none'\n        },\n        layeredInfo:{\n          name: '',\n          offerAmount: '',\n          closingBalance: '',\n          closingBalanceRate:'',\n          remainingPercent: 0,\n          offerAmountPercent: 0,\n        }\n      }\n    },\n    created() {\n      this.initLayer();\n    },\n    methods: {\n      initLayer() {\n        let totalOfferAmount = 0;\n        this.data.forEach(v => {\n          console.log(v)\n          totalOfferAmount += parseFloat(v.OfferAmount);\n        });\n\n        let layers = {};\n        let layerColors = [\n          '#759ae4',\n          '#5566ce',\n          '#01d5bf',\n          '#00c673',\n          '#bfd52a',\n          '#f19603',\n          '#a36fff'\n        ];\n        this.data.forEach((v,i) => {\n          let offerAmount =  v.OfferAmount ? parseFloat(v.OfferAmount) : 0;\n          let offerAmounts =  v.OfferAmount ? utilsIndex.numUnit(v.OfferAmount) : 0;\n          let payAmount = v.PayAmount ? parseFloat(v.PayAmount) : 0;\n          let closingBalance = v.ClosingBalance ? utilsIndex.numUnit(v.ClosingBalance) : 0;\n          let closingBalanceRate = v.ClosingBalanceRate ? parseFloat(v.ClosingBalanceRate) : 0;\n          let payAmountPercent = payAmount / offerAmount * 100;\n          let offerAmountPercent = offerAmount / totalOfferAmount * 100;\n          let currentLayer = {\n            name: v.ShortName,\n            className: v.ClassName,\n            payAmountPercent: payAmountPercent,\n            payAmountStyle: {\n              height: payAmountPercent + '%',\n            },\n            offerAmountPercent: offerAmountPercent,\n            offerAmountStyle: {\n              width: '100%',\n              backgroundColor: layerColors[i]\n            },\n            text: ((v.ClassName) ? v.ClassName : '未知') + ' ' + Math.round(offerAmountPercent) + '%',\n            offerAmounts:offerAmounts,\n            closingBalance,\n            closingBalanceRate,\n            remainingPercent: (closingBalance / offerAmount),\n            value: offerAmount\n          };\n\n          if(!layers[v.ClassName]) layers[v.ClassName] = [];\n\n          layers[v.ClassName].push(currentLayer);\n\n        });\n\n        let computedLayers = [];\n\n        let freePercent = 100;\n\n        const fixedPercent = function(percent, freeCount) {\n          let o = 100 / 6;\n          if(percent <= o) {\n            freePercent -= o;\n            return o + '%';\n          }\n          if(percent === 100) return '100%';\n          let currentPercent = percent - (percent % o);\n          if( freePercent <= currentPercent ) {\n            return freePercent + '%';\n          }else{\n\n            freePercent -= currentPercent;\n            if(freeCount > 1) {\n              let needMinPercent = freeCount * o;\n              if(freePercent < needMinPercent) {\n                currentPercent =  currentPercent - (needMinPercent - freePercent);\n                freePercent = freePercent + (needMinPercent - freePercent);\n              }\n            }\n            if(freePercent > o && freeCount === 1) {\n              let needFloatPercent = freePercent - o;\n              currentPercent += needFloatPercent;\n              freePercent += needFloatPercent;\n            }\n            return currentPercent + '%';\n          }\n        };\n\n        layers = Object.values(layers);\n\n        let totalCount = layers.length;\n\n        \n\n        layers.forEach( (layer, i) => {\n          let count = layer.length;\n          let height = 0;\n          if(count > 1) {\n            let totalPercent = layer.map(v=> v.offerAmountPercent).reduce((prev, next) => prev + next);\n            layer.forEach(v => {\n              v.offerAmountStyle.width = (v.offerAmountPercent / totalPercent * 100) + '%';\n            });\n            height = totalPercent;\n          }else{\n            height = layer[0].offerAmountPercent;\n          }\n          computedLayers.push({\n            height: fixedPercent(height, totalCount - (i + 1)),\n            layer,\n            backgroundColor: layerColors[i]\n          })\n        });\n        this.computedLayers = computedLayers;\n        this.layers = layers;\n      },\n      showInfo(event, item) {\n        //console.log(e)\n        let evt = event.target;\n        let actualLeft = evt.offsetLeft + (evt.offsetWidth / 4);\n        let actualTop = evt.offsetTop + (evt.offsetHeight / 2) + 10;\n        let current = evt.offsetParent;\n        while (current !== null && current !== this.$el){\n          actualTop += current.offsetTop;\n          actualLeft += current.offsetLeft;\n          current = current.offsetParent;\n        }\n\n        if(actualLeft >= 130) {\n          actualLeft -= (this.$el.offsetWidth - 130);\n        }\n        this.layeredInfoStyles = {\n          left: actualLeft + 'px',\n          top: actualTop + 'px',\n          display: 'block'\n        };\n        this.layeredInfo = item;\n      },\n      hideInfo(event) {\n        //console.log('out', event)\n        let evt = event.toElement;\n       if(!this.$el.contains(evt)){\n         this.layeredInfoStyles.display = 'none';\n       }\n      }\n    },\n  }\n</script>\n"],"sourceRoot":"src/components/product"}]}