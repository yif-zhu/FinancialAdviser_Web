{"remainingRequest":"C:\\Users\\yif_z\\Desktop\\DealViewer\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\yif_z\\Desktop\\DealViewer\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!C:\\Users\\yif_z\\Desktop\\DealViewer\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\yif_z\\Desktop\\DealViewer\\src\\components\\common\\AdvanceFilter.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\yif_z\\Desktop\\DealViewer\\src\\components\\common\\AdvanceFilter.vue","mtime":1604385981648},{"path":"C:\\Users\\yif_z\\Desktop\\DealViewer\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\yif_z\\Desktop\\DealViewer\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\Users\\yif_z\\Desktop\\DealViewer\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\yif_z\\Desktop\\DealViewer\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nexport default {\n  name: \"AdvanceFilter\",\n  props: {\n    conName: String,\n    templateName: String\n  },\n  data: function data() {\n    return {\n      advanceFilterUnfold: false,\n      fields: [],\n      conditionAr: [],\n      removeShow: false,\n      bondCode: ''\n    };\n  },\n  mounted: function mounted() {},\n  created: function created() {\n    this.filterOptions = [];\n    this.tooglePanel();\n  },\n  methods: {\n    bondCodeClear: function bondCodeClear() {\n      this.bondCode = '';\n      this.handleSearch();\n    },\n    compareDate: function compareDate(s1, s2) {\n      if (s1.indexOf('-') > 0) {\n        s1 = s1.replace(/-/g, \"\\/\");\n      } else if (!/\\/|-/.test(s1)) {\n        s1 = s1.slice(0, 4) + '/' + s1.slice(4, 6) + '/' + s1.slice(6, 8);\n      }\n\n      if (s2.indexOf('-') > 0) {\n        s2 = s2.replace(/-/g, \"\\/\");\n      } else if (!/\\/|-/.test(s2)) {\n        s2 = s2.slice(0, 4) + '/' + s2.slice(4, 6) + '/' + s2.slice(6, 8);\n      }\n\n      return new Date(s1) > new Date(s2);\n    },\n    removeAll: function removeAll() {\n      for (var i = 0; i < this.fields.length; i++) {\n        this.fields[i].ChosenTitles = [];\n\n        for (var ii = 0; ii < this.fields[i].Options.length; ii++) {\n          this.fields[i].Options[ii].Chosen = false;\n\n          if (!this.fields[i].UIFormat) {\n            this.fields[i].Options[ii].Chosen = false;\n          } else {\n            this.fields[i].Options[ii].Value = '';\n          }\n        }\n      }\n\n      this.handleSearch();\n    },\n    conditionOpen: function conditionOpen(index) {\n      if (!this.conditionAr[index]) {\n        this.$set(this.conditionAr, index, true);\n      } else {\n        this.$set(this.conditionAr, index, false);\n      } // console.log(this.conditionAr)\n\n    },\n    loadFiledsAndInit: function loadFiledsAndInit() {\n      var _this = this;\n\n      if (this.conName === undefined || this.templateName === undefined) {\n        return;\n      }\n\n      var svc = this.$http(this.conName, 'DV.AdvanceFilter_GetSettingByName', true);\n      svc.AddParam({\n        Name: 'TemplateName',\n        Value: this.templateName,\n        DBType: 'string'\n      });\n      svc.ExecTables().then(function (response) {\n        if (!response || response.length < 1) {\n          return;\n        }\n\n        _this.filterOptions = JSON.parse(JSON.stringify(response[1]));\n        var fields = JSON.parse(JSON.stringify(response[0]));\n        fields.map(function (field) {\n          _this.conditionAr.push(false);\n\n          field.ChosenTitles = field.ChosenTitles ? field.ChosenTitles.split(';') : [];\n\n          var fieldOptions = _this.filterOptions.filter(function (o) {\n            return o.Field === field.Field;\n          });\n\n          if (field.UIFormat === 'select') {\n            field.value = '0';\n            fieldOptions = fieldOptions.filter(function (v) {\n              return v.Text !== null;\n            });\n          }\n\n          if (field.UIFormat === 'date') {\n            field.value = '';\n            field.value1 = '';\n          }\n\n          fieldOptions.forEach(function (v) {\n            if (field.UIFormat && field.UIFormat === 'input') {\n              v.ValueExpress = v.Value;\n              v.Value = '';\n            }\n          });\n          field.Options = fieldOptions;\n        });\n        _this.fields = fields;\n      });\n    },\n    removeFieldChosen: function removeFieldChosen(field) {\n      var isInput = field.UIFormat;\n\n      for (var i = 0, length = field.Options.length; i < length; i++) {\n        if (!isInput) {\n          field.Options[i].Chosen = false;\n        } else {\n          field.Options[i].Value = '';\n        }\n      }\n\n      field.ChosenTitles = []; // console.log(this.fields)\n\n      this.handleSearch();\n    },\n    toogleOptionChosen: function toogleOptionChosen(field, option) {\n      console.log('d', field);\n\n      if (option.Chosen && field.Must) {\n        return;\n      }\n\n      if (option.Chosen) {\n        for (var i = 0; i < field.ChosenTitles.length; i++) {\n          if (field.ChosenTitles[i] == option.Text) {\n            field.ChosenTitles.splice(i, 1);\n          }\n        }\n\n        option.Chosen = false;\n      } else {\n        if (field.Radio) {\n          field.ChosenTitles = [option.Text];\n\n          for (var i = 0, length = field.Options.length; i < length; i++) {\n            field.Options[i].Chosen = false;\n          }\n        } else {\n          field.ChosenTitles.push(option.Text);\n        }\n\n        option.Chosen = true;\n      }\n\n      this.handleSearch();\n      this.advanceFilterUnfold = true;\n    },\n    formatUIValueChange: function formatUIValueChange(field) {\n      var chosenTitles = [];\n\n      for (var i = 0, length = field.Options.length; i < length; i++) {\n        var option = field.Options[i];\n\n        if (option.Value) {\n          //var title = option.Text ? '{0} {1}'.Format(option.Text, option.Value) : option.Value;\n          chosenTitles.push(option.Value);\n          option.Chosen = true;\n        } else {\n          option.Chosen = false;\n        }\n      }\n\n      field.ChosenTitles = chosenTitles;\n      this.handleSearch();\n    },\n    tooglePanel: function tooglePanel() {\n      this.advanceFilterUnfold = !this.advanceFilterUnfold;\n\n      if (this.$parent.isOpenFilter !== undefined) {\n        this.$parent.isOpenFilter = this.advanceFilterUnfold;\n      }\n\n      if (this.advanceFilterUnfold && this.fields.length === 0 && this.filterOptions.length === 0) {\n        this.loadFiledsAndInit();\n      }\n    },\n    handleSearch: function handleSearch() {\n      var ary = [];\n      var num = 0;\n\n      for (var i = 0, length = this.fields.length; i < length; i++) {\n        var fld = this.fields[i];\n\n        if (fld.UIFormat === 'date' && fld.value && fld.value1) {\n          if (this.compareDate(fld.value, fld.value1)) {\n            this.$message.error('起始日期不能大于终止日期！');\n            return;\n          }\n\n          ary.push(\"(\".concat(fld.Field, \" between '\").concat(fld.value, \"' and '\").concat(fld.value1, \"')\"));\n        }\n\n        if (fld.UIFormat === 'select' && fld.value !== '0') {\n          ary.push(\"\".concat(fld.Field, \" = N'\").concat(fld.value, \"'\"));\n        }\n\n        if (fld.ChosenTitles.length < 1) {\n          num++;\n          continue;\n        }\n\n        var optary = [];\n\n        if (fld.UIFormat !== 'date' && fld.UIFormat !== 'select') {\n          for (var j = 0, jlen = fld.Options.length; j < jlen; j++) {\n            var opt = fld.Options[j];\n\n            if (!opt.Chosen) {\n              continue;\n            }\n\n            if (!fld.OptionUsing) {\n              if (!fld.UIFormat) {\n                if (opt.Value === 'is null') {\n                  optary.push('{0} {1}'.Format(fld.Field, opt.Value));\n                } else {\n                  if (opt.Value.indexOf(',') > -1) {\n                    for (var a = 0; a < opt.Value.split(',').length; a++) {\n                      optary.push('{0}=N\\'{1}\\''.Format(fld.Field, opt.Value.split(',')[a]));\n                    }\n                  } else {\n                    optary.push('{0}=N\\'{1}\\''.Format(fld.Field, opt.Value));\n                  }\n                }\n              } else {\n                optary.push(opt.ValueExpress.replace(/#PH#/g, opt.Value));\n              }\n            } else {\n              //using option value as filter condition directly\n              if (opt.Value) {\n                optary.push(opt.Value);\n              }\n            }\n          }\n\n          if (optary.length == 1) {\n            ary.push(optary.join(' '));\n          } else if (optary.length > 1) {\n            var cnct = fld.UIFormat ? ' and ' : ' or ';\n            ary.push('(' + optary.join(cnct) + ')');\n          }\n        }\n      }\n\n      if (num == this.fields.length) {\n        this.removeShow = false;\n      } else {\n        this.removeShow = true;\n      }\n\n      this.$emit('handleSearch', ary.join(' and '), this.bondCode); // this.advanceFilterUnfold = false;\n\n      if (this.$parent.isOpenFilter !== undefined) {\n        this.$parent.isOpenFilter = false;\n      }\n\n      this.$emit('handleSearchCon', this.fields, this.removeShow);\n    },\n    // 刷新数据\n    refresh: function refresh() {\n      this.loadFiledsAndInit();\n    }\n  }\n};",{"version":3,"sources":["AdvanceFilter.vue"],"names":[],"mappings":"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","sourcesContent":["<style lang=\"scss\" scoped>\n  .advance-filter {\n    height: 100%;\n    border-right: 1px solid $--color-grey-border;\n    &-header {\n      height: 39px;\n      line-height: 39px;\n      border-bottom: 1px solid $--color-grey-border;\n      .left{\n\n        i{\n          font-size: 14px;\n          margin-right: 5px;\n          color: $--color-primary;\n        }\n      }\n    }\n\n    .condition{\n      line-height: 20px;\n      font-size: 12px;\n    }\n    .clear-condition{\n      font-size: 12px;\n    }\n    .filter-button {\n      font-weight: 500;\n      color: #777;\n      padding: 0;\n\n      i.icon-searchlist {\n        font-size: 25px;\n        vertical-align: -4px;\n      }\n\n      &.is-unfold,\n      &:hover {\n        color: $--color-primary;\n      }\n    }\n\n    &-body{\n      padding: 10px 10px 10px 20px;\n      padding-left: 0;\n      font-size: 12px;\n      height: calc(100% - 47px);\n      overflow: auto;\n      padding-right: 0;\n\n      /deep/ >.el-scrollbar {\n        height: 100%;\n        .el-scrollbar__wrap {\n          overflow-x: hidden;\n        }\n      }\n    }\n\n    .chosen-fields {\n      display: inline-block;\n      margin-bottom: 10px;\n      margin-right: 10px;\n      background-color: #fff;\n      border:1px solid $--color-grey-light;\n      color: $--color-primary;\n      border-radius: 3px;\n      font-size: 12px;\n      position: relative;\n      padding-right: 22px;\n      &:hover{\n        border-color: $--color-primary;\n        .field-remove{\n          background-color: $--color-primary;\n          color: #fff;\n\n        }\n      }\n      .field-titles {\n        margin-right: 5px;\n        display: inline-block;\n        padding: 3px 0 3px 10px;\n        .title{\n          color: $--color-black;\n        }\n      }\n\n      .field-remove {\n        display: inline-block;\n        height: 100%;\n        cursor: pointer;\n        padding:0 5px;\n        position: absolute;\n        top: 0;right: -1px;\n        line-height: 26px;\n      }\n    }\n\n    .filter-condition-row {\n      margin-bottom: 5px;\n      padding-right: 15px;\n      &:last-child {\n        border-bottom: none;\n        padding-bottom: 0;\n        margin-bottom: 0;\n      }\n    }\n\n    .filter-label {\n      min-width: 100px;\n      font-weight: bold;\n      color: $--color-black;\n      margin-bottom: 10px;\n    }\n\n    .filter-title {\n      font-weight: 500;\n      font-size: 16px;\n      color: grey;\n      /*$--color-gray;*/\n      display: inline-block;\n      margin-right: 10px;\n    }\n\n    .filter-tag {\n      height: 26px;\n      line-height: 24px;\n      margin: 0 10px 5px 0;\n      padding: 0 10px;\n      border-color: $--color-grey-border;\n      border-radius: 3px;\n      color: $--color-grey;\n\n      &:hover {\n        border-color: $--color-primary;\n        color: $--color-primary;\n        cursor: pointer;\n      }\n\n      &.active {\n        border-color: $--color-primary;\n        color: #fff;\n        background-color: $--color-primary;\n      }\n    }\n\n    .more{\n      margin-top: 5px;\n      margin-right: 8px;\n    }\n\n    .spea-center{\n      text-align: center;\n      line-height: 26px;\n    }\n\n  }\n\n  .loading-preload{\n    width: 35%;\n    height: 20px;\n    margin-bottom: 10px;\n    border-radius: 2px;\n    &:nth-child(2) {\n      width: 60%;\n    }\n    &:nth-child(3) {\n      width: 42%;\n    }\n  }\n  .date-interval{\n    /deep/ .el-input--suffix .el-input__inner{\n      padding-right: 10px;\n    }\n  }\n</style>\n<style lang=\"scss\">\n  $--load-color: #e1e3ef;\n  $--load-living-color: #e6e8f5;\n\n  /* 数据加载 占位显示效果 */\n\n  .loading {\n    background-color: $--load-color;\n  }\n  .max-width{\n    max-width: 300px;\n  }\n</style>\n\n<template>\n  <div class=\"advance-filter\">\n    <div class=\"advance-filter-header\">\n      <span class=\"left\"><i class=\"iconfont icon-shaixuan\"></i>筛选条件</span>\n    </div>\n    <div class=\"advance-filter-body\">\n      <!-- <div v-if=\"fields.length > 0\" class=\"condition\">\n        <div v-for=\"field in fields\" :key=\"field.Title\" v-show=\"field.ChosenTitles.length>0\"\n             class=\"chosen-fields\">\n          <span class=\"field-titles\"><span class=\"title\">{{field.Title}}：</span>{{field.UIFormat?field.ChosenTitles.join(\" - \"):field.ChosenTitles.join(\", \")}}</span>\n          <span class=\"field-remove\" v-if=\"!field.Must\" @click=\"removeFieldChosen(field)\">\n            <i class=\"el-icon-close\"></i>\n          </span>\n        </div>\n        <span @click=\"removeAll()\" class=\"colorPrimary ml-15 clear-condition\" v-show=\"removeShow\">清除筛选</span>\n      </div> -->\n      <el-scrollbar>\n        <template v-if=\"fields.length > 0\">\n          <div v-for=\"(field,indexs) in fields\" :key=\"field.Title\"\n               class=\"filter-condition-row\" :class=\"{'pb-5':field.UIFormat}\">\n            <div class=\"filter-label text-ellipsis\">\n              {{field.Title}}\n            </div>\n            <div v-if=\"!field.UIFormat\">\n              <el-tag v-for=\"(option,index) in field.Options\"\n                      @click.native=\"toogleOptionChosen(field, option)\" :class=\"{active: option.Chosen }\"\n                      :key=\"option.Text\" class=\"filter-tag\">{{option.Text}} </el-tag>\n\n              <i class=\"iconfont icon-zhankai cursorP fr colorPrimary more\" :class=\"conditionAr[indexs]?'transformRotate180':''\" :title=\"conditionAr[indexs]?'收起':'展开'\" v-if=\"field.Options.length>100\" @click=\"conditionOpen(indexs)\"></i>\n            </div>\n            <template v-else-if=\"field.UIFormat === 'select'\">\n              <el-select size=\"mini\" v-model=\"field.value\" popper-class=\"max-width\" style=\"width: 100%;\" filterable @change=\"handleSearch\">\n                <el-option label=\"全部\" value=\"0\"></el-option>\n                <el-option v-for=\"(option, index) in field.Options\" :label=\"option.Text\" :value=\"option.Value\" :key=\"indexs+'-'+index\"></el-option>\n              </el-select>\n            </template>\n            <template v-else-if=\"field.UIFormat === 'date'\">\n              <el-row class=\"date-interval\">\n                <el-col :span=\"11\">\n                  <el-date-picker v-model=\"field.value\"\n                                  type=\"date\"\n                                  size=\"mini\"\n                                  placeholder=\"起始\"\n                                  style=\"width: 100%\"\n                                  @change=\"handleSearch\"\n                                  :value-format=\"'yyyy-MM-dd'\">\n                  </el-date-picker>\n                </el-col>\n                <el-col :span=\"2\" class=\"spea-center\">-</el-col>\n                <el-col :span=\"11\">\n                  <el-date-picker v-model=\"field.value1\"\n                                  type=\"date\"\n                                  size=\"mini\"\n                                  placeholder=\"终止\"\n                                  style=\"width: 100%\"\n                                  @change=\"handleSearch\"\n                                  :value-format=\"'yyyy-MM-dd'\">\n                  </el-date-picker>\n                </el-col>\n              </el-row>\n            </template>\n            <template v-else v-for=\"option in field.Options\">\n              <div class=\"text-center line\" v-if=\"option.Text\">{{option.Text}}</div>\n              <div>\n                <el-input v-model=\"option.Value\" size=\"mini\" @change=\"formatUIValueChange(field)\"\n                          clearable placeholder=\"请输入查询关键字\"></el-input>\n              </div>\n              <div class=\"text-center line\"  style=\"font-weight: bold;color: rgba(0, 0, 0, 0.85); margin: 5px 0 10px 0;\">证券代码</div>\n             <div v-if=\"field.Field === 'TrustName'\">\n                <el-input v-model=\"bondCode\" size=\"mini\" @change=\"formatUIValueChange(field)\"\n                          clearable placeholder=\"请输入证券代码\"></el-input>\n              </div>\n            </template>\n          </div>\n        </template>\n        <template v-else>\n          <!--数据加载效果-->\n          <div class=\"loading-preload loading\"></div>\n          <div class=\"loading-preload loading\"></div>\n          <div class=\"loading-preload loading\"></div>\n        </template>\n      </el-scrollbar>\n    </div>\n  </div>\n</template>\n\n<script>\n  export default {\n    name: \"AdvanceFilter\",\n    props: {\n      conName: String,\n      templateName: String\n    },\n    data: () => ({\n      advanceFilterUnfold: false,\n      fields: [],\n      conditionAr:[],\n      removeShow:false,\n      bondCode:'',\n    }),\n    mounted() {\n\n    },\n    created() {\n      this.filterOptions = []\n      this.tooglePanel()\n    },\n    methods: {\n      bondCodeClear() {\n        this.bondCode = '';\n        this.handleSearch()\n      },\n      compareDate(s1, s2){\n        if(s1.indexOf('-') > 0) {\n          s1 = s1.replace(/-/g,\"\\/\");\n        }else if(!/\\/|-/.test(s1)) {\n          s1 = s1.slice(0, 4) + '/' + s1.slice(4,6) + '/' + s1.slice(6,8);\n        }\n        if(s2.indexOf('-') > 0) {\n          s2 = s2.replace(/-/g,\"\\/\");\n        }else if(!/\\/|-/.test(s2)) {\n          s2 = s2.slice(0, 4) + '/' + s2.slice(4,6) + '/' + s2.slice(6,8);\n        }\n        return ((new Date(s1)) > (new Date(s2)));\n      },\n      removeAll() {\n\n        for (var i = 0; i < this.fields.length; i++) {\n          this.fields[i].ChosenTitles = []\n          for (var ii = 0; ii < this.fields[i].Options.length; ii++) {\n            this.fields[i].Options[ii].Chosen = false;\n            if (!this.fields[i].UIFormat) {\n              this.fields[i].Options[ii].Chosen = false;\n            } else {\n              this.fields[i].Options[ii].Value = '';\n            }\n          }\n        }\n        this.handleSearch()\n      },\n      conditionOpen(index) {\n        if (!this.conditionAr[index]) {\n          this.$set(this.conditionAr,index,true)\n        }else{\n          this.$set(this.conditionAr,index,false)\n        }\n        // console.log(this.conditionAr)\n      },\n      loadFiledsAndInit() {\n        if (this.conName === undefined || this.templateName === undefined) {\n          return;\n        }\n        var svc = this.$http(this.conName, 'DV.AdvanceFilter_GetSettingByName', true);\n        svc.AddParam({\n          Name: 'TemplateName',\n          Value: this.templateName,\n          DBType: 'string'\n        });\n        svc.ExecTables().then((response) => {\n          if (!response || response.length < 1) {\n            return;\n          }\n          this.filterOptions = JSON.parse(JSON.stringify(response[1]));\n          let fields = JSON.parse(JSON.stringify(response[0]));\n          fields.map((field) => {\n            this.conditionAr.push(false)\n            field.ChosenTitles = (field.ChosenTitles) ? field.ChosenTitles.split(';') : [];\n            let fieldOptions = this.filterOptions.filter((o) => (o.Field === field.Field));\n            if (field.UIFormat === 'select') {\n              field.value = '0';\n              fieldOptions = fieldOptions.filter(v => v.Text !== null);\n            }\n            if(field.UIFormat === 'date') {\n              field.value = '';\n              field.value1 = '';\n            }\n\n            fieldOptions.forEach((v) => {\n              if (field.UIFormat && field.UIFormat === 'input') {\n                v.ValueExpress = v.Value;\n                v.Value = '';\n              }\n            });\n            field.Options = fieldOptions;\n          });\n\n          this.fields = fields;\n        });\n      },\n      removeFieldChosen(field) {\n        let isInput = field.UIFormat;\n        for (let i = 0, length = field.Options.length; i < length; i++) {\n          if (!isInput) {\n            field.Options[i].Chosen = false;\n          } else {\n            field.Options[i].Value = '';\n          }\n        }\n        field.ChosenTitles = [];\n        // console.log(this.fields)\n        this.handleSearch()\n      },\n      toogleOptionChosen(field, option) {\n        console.log('d', field);\n        if (option.Chosen && field.Must) {\n          return;\n        }\n        if (option.Chosen) {\n          for (var i = 0; i < field.ChosenTitles.length; i++) {\n            if (field.ChosenTitles[i] == option.Text) {\n              field.ChosenTitles.splice(i, 1);\n            }\n          }\n          option.Chosen = false;\n        } else {\n          if (field.Radio) {\n            field.ChosenTitles = [option.Text];\n            for (var i = 0, length = field.Options.length; i < length; i++) {\n              field.Options[i].Chosen = false;\n            }\n          } else {\n            field.ChosenTitles.push(option.Text);\n          }\n          option.Chosen = true;\n        }\n        this.handleSearch()\n        this.advanceFilterUnfold = true\n      },\n      formatUIValueChange(field) {\n        var chosenTitles = [];\n        for (var i = 0, length = field.Options.length; i < length; i++) {\n          var option = field.Options[i];\n          if (option.Value) {\n            //var title = option.Text ? '{0} {1}'.Format(option.Text, option.Value) : option.Value;\n            chosenTitles.push(option.Value);\n            option.Chosen = true;\n          } else {\n            option.Chosen = false;\n          }\n        }\n        field.ChosenTitles = chosenTitles;\n        this.handleSearch()\n      },\n      tooglePanel() {\n        this.advanceFilterUnfold = !this.advanceFilterUnfold;\n        if (this.$parent.isOpenFilter !== undefined) {\n          this.$parent.isOpenFilter = this.advanceFilterUnfold;\n        }\n        if (this.advanceFilterUnfold &&\n          this.fields.length === 0 &&\n          this.filterOptions.length === 0) {\n\n          this.loadFiledsAndInit();\n        }\n      },\n      handleSearch() {\n        var ary = [];var num = 0;\n        for (var i = 0, length = this.fields.length; i < length; i++) {\n          var fld = this.fields[i];\n          if(fld.UIFormat === 'date' && fld.value && fld.value1) {\n            if(this.compareDate(fld.value, fld.value1)) {\n              this.$message.error('起始日期不能大于终止日期！');\n              return;\n            }\n            ary.push(`(${fld.Field} between '${fld.value}' and '${fld.value1}')`)\n          }\n          if(fld.UIFormat === 'select' && fld.value !== '0') {\n            ary.push(`${fld.Field} = N'${fld.value}'`);\n          }\n          if (fld.ChosenTitles.length < 1) {\n            num++\n            continue;\n          }\n          var optary = [];\n          if(fld.UIFormat !== 'date' && fld.UIFormat !== 'select') {\n            for (var j = 0, jlen = fld.Options.length; j < jlen; j++) {\n              var opt = fld.Options[j];\n              if (!opt.Chosen) {\n                continue;\n              }\n              if (!fld.OptionUsing) {\n                if (!fld.UIFormat) {\n                  if (opt.Value === 'is null') {\n                    optary.push('{0} {1}'.Format(fld.Field, opt.Value));\n                  } else {\n                    if (opt.Value.indexOf(',')>-1) {\n                      for (var a = 0; a < opt.Value.split(',').length; a++) {\n                        optary.push('{0}=N\\'{1}\\''.Format(fld.Field, opt.Value.split(',')[a]));\n                      }\n                    }else{\n                      optary.push('{0}=N\\'{1}\\''.Format(fld.Field, opt.Value));\n                    }\n                  }\n                } else {\n                  optary.push(opt.ValueExpress.replace(/#PH#/g, opt.Value));\n                }\n              } else { //using option value as filter condition directly\n                if (opt.Value) {\n                  optary.push(opt.Value);\n                }\n              }\n            }\n            if (optary.length == 1) {\n              ary.push(optary.join(' '));\n            } else if (optary.length > 1) {\n              var cnct = fld.UIFormat ? ' and ' : ' or ';\n              ary.push('(' + optary.join(cnct) + ')');\n            }\n          }\n        }\n        if (num == this.fields.length) {\n          this.removeShow = false\n        }else{\n          this.removeShow = true\n        }\n        this.$emit('handleSearch', ary.join(' and '),this.bondCode);\n        // this.advanceFilterUnfold = false;\n        if (this.$parent.isOpenFilter !== undefined) {\n          this.$parent.isOpenFilter = false;\n        }\n        this.$emit('handleSearchCon',this.fields,this.removeShow)\n      },\n      // 刷新数据\n      refresh() {\n        this.loadFiledsAndInit();\n      }\n    },\n  };\n\n</script>\n"],"sourceRoot":"src/components/common"}]}