{"remainingRequest":"C:\\Users\\yif_z\\Desktop\\DealViewer\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\yif_z\\Desktop\\DealViewer\\src\\components\\product\\RepaymentMatrix.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\yif_z\\Desktop\\DealViewer\\src\\components\\product\\RepaymentMatrix.vue","mtime":1604281046595},{"path":"C:\\Users\\yif_z\\Desktop\\DealViewer\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\yif_z\\Desktop\\DealViewer\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\Users\\yif_z\\Desktop\\DealViewer\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\yif_z\\Desktop\\DealViewer\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport utilsIndex from '@/utils/index.js'\nexport default {\n  name: \"RepaymentMatrix\",\n  props: {\n    data: {\n      type: Array,\n      default: () => []\n    }\n  },\n  data() {\n    return {\n      layers: [],\n      computedLayers: [],\n      layeredInfoStyles: {\n        top: 0,\n        left: 0,\n        display: 'none'\n      },\n      layeredInfo:{\n        name: '',\n        offerAmount: '',\n        closingBalance: '',\n        closingBalanceRate:'',\n        remainingPercent: 0,\n        offerAmountPercent: 0,\n      }\n    }\n  },\n  created() {\n    this.initLayer();\n  },\n  methods: {\n    initLayer() {\n      let totalOfferAmount = 0;\n      this.data.forEach(v => {\n        console.log(v)\n        totalOfferAmount += parseFloat(v.OfferAmount);\n      });\n\n      let layers = {};\n      let layerColors = [\n        '#759ae4',\n        '#5566ce',\n        '#01d5bf',\n        '#00c673',\n        '#bfd52a',\n        '#f19603',\n        '#a36fff'\n      ];\n      this.data.forEach((v,i) => {\n        let offerAmount =  v.OfferAmount ? parseFloat(v.OfferAmount) : 0;\n        let offerAmounts =  v.OfferAmount ? utilsIndex.numUnit(v.OfferAmount) : 0;\n        let payAmount = v.PayAmount ? parseFloat(v.PayAmount) : 0;\n        let closingBalance = v.ClosingBalance ? utilsIndex.numUnit(v.ClosingBalance) : 0;\n        let closingBalanceRate = v.ClosingBalanceRate ? parseFloat(v.ClosingBalanceRate) : 0;\n        let payAmountPercent = payAmount / offerAmount * 100;\n        let offerAmountPercent = offerAmount / totalOfferAmount * 100;\n        let currentLayer = {\n          name: v.ShortName,\n          className: v.ClassName,\n          payAmountPercent: payAmountPercent,\n          payAmountStyle: {\n            height: payAmountPercent + '%',\n          },\n          offerAmountPercent: offerAmountPercent,\n          offerAmountStyle: {\n            width: '100%',\n            backgroundColor: layerColors[i]\n          },\n          text: ((v.ClassName) ? v.ClassName : '未知') + ' ' + Math.round(offerAmountPercent) + '%',\n          offerAmounts:offerAmounts,\n          closingBalance,\n          closingBalanceRate,\n          remainingPercent: (closingBalance / offerAmount),\n          value: offerAmount\n        };\n\n        if(!layers[v.ClassName]) layers[v.ClassName] = [];\n\n        layers[v.ClassName].push(currentLayer);\n\n      });\n\n      let computedLayers = [];\n\n      let freePercent = 100;\n\n      const fixedPercent = function(percent, freeCount) {\n        let o = 100 / 6;\n        if(percent <= o) {\n          freePercent -= o;\n          return o + '%';\n        }\n        if(percent === 100) return '100%';\n        let currentPercent = percent - (percent % o);\n        if( freePercent <= currentPercent ) {\n          return freePercent + '%';\n        }else{\n\n          freePercent -= currentPercent;\n          if(freeCount > 1) {\n            let needMinPercent = freeCount * o;\n            if(freePercent < needMinPercent) {\n              currentPercent =  currentPercent - (needMinPercent - freePercent);\n              freePercent = freePercent + (needMinPercent - freePercent);\n            }\n          }\n          if(freePercent > o && freeCount === 1) {\n            let needFloatPercent = freePercent - o;\n            currentPercent += needFloatPercent;\n            freePercent += needFloatPercent;\n          }\n          return currentPercent + '%';\n        }\n      };\n\n      layers = Object.values(layers);\n\n      let totalCount = layers.length;\n\n      \n\n      layers.forEach( (layer, i) => {\n        let count = layer.length;\n        let height = 0;\n        if(count > 1) {\n          let totalPercent = layer.map(v=> v.offerAmountPercent).reduce((prev, next) => prev + next);\n          layer.forEach(v => {\n            v.offerAmountStyle.width = (v.offerAmountPercent / totalPercent * 100) + '%';\n          });\n          height = totalPercent;\n        }else{\n          height = layer[0].offerAmountPercent;\n        }\n        computedLayers.push({\n          height: fixedPercent(height, totalCount - (i + 1)),\n          layer,\n          backgroundColor: layerColors[i]\n        })\n      });\n      this.computedLayers = computedLayers;\n      this.layers = layers;\n    },\n    showInfo(event, item) {\n      //console.log(e)\n      let evt = event.target;\n      let actualLeft = evt.offsetLeft + (evt.offsetWidth / 4);\n      let actualTop = evt.offsetTop + (evt.offsetHeight / 2) + 10;\n      let current = evt.offsetParent;\n      while (current !== null && current !== this.$el){\n        actualTop += current.offsetTop;\n        actualLeft += current.offsetLeft;\n        current = current.offsetParent;\n      }\n\n      if(actualLeft >= 130) {\n        actualLeft -= (this.$el.offsetWidth - 130);\n      }\n      this.layeredInfoStyles = {\n        left: actualLeft + 'px',\n        top: actualTop + 'px',\n        display: 'block'\n      };\n      this.layeredInfo = item;\n    },\n    hideInfo(event) {\n      //console.log('out', event)\n      let evt = event.toElement;\n     if(!this.$el.contains(evt)){\n       this.layeredInfoStyles.display = 'none';\n     }\n    }\n  },\n}\n",{"version":3,"sources":["RepaymentMatrix.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;;;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"RepaymentMatrix.vue","sourceRoot":"src/components/product","sourcesContent":["<style lang=\"scss\" scoped>\n  .repayment-matrix{\n    position: relative;\n    width: 250px;\n    height: 160px;\n    margin-bottom: 10px;\n    display: inline-block;\n    .layered-container{\n      display: flex;\n      flex-direction: column;\n\n      &.is-horizontal{\n        flex-direction: row;\n      }\n    }\n\n    .layered{\n      position: relative;\n      border: 1px solid #fff;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      overflow: hidden;\n      height: 100%;\n      font-size: 12px;\n      color: #fff;\n      text-align: center;\n\n      .layered-used-space{\n        position: absolute;\n        top: 0;\n        right: 0;\n        left: 0;\n        opacity: 1;\n        pointer-events: none;\n        background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAGCAYAAAD37n+BAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAF8WlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDAgNzkuMTYwNDUxLCAyMDE3LzA1LzA2LTAxOjA4OjIxICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgKE1hY2ludG9zaCkiIHhtcDpDcmVhdGVEYXRlPSIyMDE4LTA2LTEzVDEzOjQ4OjU3KzA4OjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAxOC0wNi0xM1QxNDoxNDozNyswODowMCIgeG1wOk1ldGFkYXRhRGF0ZT0iMjAxOC0wNi0xM1QxNDoxNDozNyswODowMCIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiIHBob3Rvc2hvcDpJQ0NQcm9maWxlPSJzUkdCIElFQzYxOTY2LTIuMSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDoyZGIxNzU5NC05OWVmLTRjZTEtOWRkMi1iNTIwZmM0OTAyOTEiIHhtcE1NOkRvY3VtZW50SUQ9ImFkb2JlOmRvY2lkOnBob3Rvc2hvcDo2NDliNzgyMC0yOGUxLTIyNDctOWMxOS1jMTI3YTQwNmJlZDUiIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDowZjIwZWFmMC01NDExLTQ4NmQtYWYxYS1lZTI4NzM3ZjQ1ODYiPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJjcmVhdGVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjBmMjBlYWYwLTU0MTEtNDg2ZC1hZjFhLWVlMjg3MzdmNDU4NiIgc3RFdnQ6d2hlbj0iMjAxOC0wNi0xM1QxMzo0ODo1NyswODowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIENDIChNYWNpbnRvc2gpIi8+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJzYXZlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDoyZGIxNzU5NC05OWVmLTRjZTEtOWRkMi1iNTIwZmM0OTAyOTEiIHN0RXZ0OndoZW49IjIwMTgtMDYtMTNUMTQ6MTQ6MzcrMDg6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCBDQyAoTWFjaW50b3NoKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8L3JkZjpTZXE+IDwveG1wTU06SGlzdG9yeT4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz7e4M9IAAAAKElEQVQYlWP8//8/AxQ0oNFYxZkYSAQsxJoMAyTbwIjkB7wmM5DrBwBqHAuHsM3a0gAAAABJRU5ErkJggg==) repeat;\n      }\n    }\n\n    .layered-info{\n      position: absolute;\n      width: 130px;\n      padding: 5px;\n      background-color: #fff;\n      font-size: 12px;\n      line-height: 1.77;\n      color: #555;\n      z-index: 9999;\n      box-shadow: 0 0 3px 0 rgba(0, 0, 0, .2);\n      \n      p {\n        span{\n          color: #999;\n          margin-right: 3px;\n        }\n      }\n    }\n  }\n</style>\n\n<template>\n  <div class=\"repayment-matrix\">\n    <div v-for=\"(con, i) in computedLayers\"\n         class=\"layered-container\"\n         :class=\"{'is-horizontal': con.layer.length > 1}\"\n         :style=\"{height: con.height, backgroundColor: con.backgroundColor}\"\n         :key=\"i\">\n      <div class=\"layered\"\n           v-for=\"(item, index) in con.layer\"\n           :style=\"item.offerAmountStyle\"\n           @mouseover=\"showInfo($event, item)\"\n           @mouseout=\"hideInfo\"\n           :key=\"index\">\n        <div class=\"layered-used-space\" :style=\"item.payAmountStyle\"></div>\n        <!-- {{item.text}} -->\n      </div>\n    </div>\n    <div class=\"layered-info\" :style=\"layeredInfoStyles\">\n      <p><span>证券简称</span>{{layeredInfo.name}}</p>\n      <p><span>分层占比</span>{{layeredInfo.offerAmountPercent.toFixed(2)}}%</p>\n      <p><span>初始本金</span>{{layeredInfo.offerAmounts}}</p>\n      <p><span>剩余本金</span>{{layeredInfo.closingBalance}}</p>\n      <p><span>剩余占比</span>{{layeredInfo.closingBalanceRate}}%</p>\n    </div>\n  </div>\n</template>\n\n<script>\n  import utilsIndex from '@/utils/index.js'\n  export default {\n    name: \"RepaymentMatrix\",\n    props: {\n      data: {\n        type: Array,\n        default: () => []\n      }\n    },\n    data() {\n      return {\n        layers: [],\n        computedLayers: [],\n        layeredInfoStyles: {\n          top: 0,\n          left: 0,\n          display: 'none'\n        },\n        layeredInfo:{\n          name: '',\n          offerAmount: '',\n          closingBalance: '',\n          closingBalanceRate:'',\n          remainingPercent: 0,\n          offerAmountPercent: 0,\n        }\n      }\n    },\n    created() {\n      this.initLayer();\n    },\n    methods: {\n      initLayer() {\n        let totalOfferAmount = 0;\n        this.data.forEach(v => {\n          console.log(v)\n          totalOfferAmount += parseFloat(v.OfferAmount);\n        });\n\n        let layers = {};\n        let layerColors = [\n          '#759ae4',\n          '#5566ce',\n          '#01d5bf',\n          '#00c673',\n          '#bfd52a',\n          '#f19603',\n          '#a36fff'\n        ];\n        this.data.forEach((v,i) => {\n          let offerAmount =  v.OfferAmount ? parseFloat(v.OfferAmount) : 0;\n          let offerAmounts =  v.OfferAmount ? utilsIndex.numUnit(v.OfferAmount) : 0;\n          let payAmount = v.PayAmount ? parseFloat(v.PayAmount) : 0;\n          let closingBalance = v.ClosingBalance ? utilsIndex.numUnit(v.ClosingBalance) : 0;\n          let closingBalanceRate = v.ClosingBalanceRate ? parseFloat(v.ClosingBalanceRate) : 0;\n          let payAmountPercent = payAmount / offerAmount * 100;\n          let offerAmountPercent = offerAmount / totalOfferAmount * 100;\n          let currentLayer = {\n            name: v.ShortName,\n            className: v.ClassName,\n            payAmountPercent: payAmountPercent,\n            payAmountStyle: {\n              height: payAmountPercent + '%',\n            },\n            offerAmountPercent: offerAmountPercent,\n            offerAmountStyle: {\n              width: '100%',\n              backgroundColor: layerColors[i]\n            },\n            text: ((v.ClassName) ? v.ClassName : '未知') + ' ' + Math.round(offerAmountPercent) + '%',\n            offerAmounts:offerAmounts,\n            closingBalance,\n            closingBalanceRate,\n            remainingPercent: (closingBalance / offerAmount),\n            value: offerAmount\n          };\n\n          if(!layers[v.ClassName]) layers[v.ClassName] = [];\n\n          layers[v.ClassName].push(currentLayer);\n\n        });\n\n        let computedLayers = [];\n\n        let freePercent = 100;\n\n        const fixedPercent = function(percent, freeCount) {\n          let o = 100 / 6;\n          if(percent <= o) {\n            freePercent -= o;\n            return o + '%';\n          }\n          if(percent === 100) return '100%';\n          let currentPercent = percent - (percent % o);\n          if( freePercent <= currentPercent ) {\n            return freePercent + '%';\n          }else{\n\n            freePercent -= currentPercent;\n            if(freeCount > 1) {\n              let needMinPercent = freeCount * o;\n              if(freePercent < needMinPercent) {\n                currentPercent =  currentPercent - (needMinPercent - freePercent);\n                freePercent = freePercent + (needMinPercent - freePercent);\n              }\n            }\n            if(freePercent > o && freeCount === 1) {\n              let needFloatPercent = freePercent - o;\n              currentPercent += needFloatPercent;\n              freePercent += needFloatPercent;\n            }\n            return currentPercent + '%';\n          }\n        };\n\n        layers = Object.values(layers);\n\n        let totalCount = layers.length;\n\n        \n\n        layers.forEach( (layer, i) => {\n          let count = layer.length;\n          let height = 0;\n          if(count > 1) {\n            let totalPercent = layer.map(v=> v.offerAmountPercent).reduce((prev, next) => prev + next);\n            layer.forEach(v => {\n              v.offerAmountStyle.width = (v.offerAmountPercent / totalPercent * 100) + '%';\n            });\n            height = totalPercent;\n          }else{\n            height = layer[0].offerAmountPercent;\n          }\n          computedLayers.push({\n            height: fixedPercent(height, totalCount - (i + 1)),\n            layer,\n            backgroundColor: layerColors[i]\n          })\n        });\n        this.computedLayers = computedLayers;\n        this.layers = layers;\n      },\n      showInfo(event, item) {\n        //console.log(e)\n        let evt = event.target;\n        let actualLeft = evt.offsetLeft + (evt.offsetWidth / 4);\n        let actualTop = evt.offsetTop + (evt.offsetHeight / 2) + 10;\n        let current = evt.offsetParent;\n        while (current !== null && current !== this.$el){\n          actualTop += current.offsetTop;\n          actualLeft += current.offsetLeft;\n          current = current.offsetParent;\n        }\n\n        if(actualLeft >= 130) {\n          actualLeft -= (this.$el.offsetWidth - 130);\n        }\n        this.layeredInfoStyles = {\n          left: actualLeft + 'px',\n          top: actualTop + 'px',\n          display: 'block'\n        };\n        this.layeredInfo = item;\n      },\n      hideInfo(event) {\n        //console.log('out', event)\n        let evt = event.toElement;\n       if(!this.$el.contains(evt)){\n         this.layeredInfoStyles.display = 'none';\n       }\n      }\n    },\n  }\n</script>\n"]}]}