{"remainingRequest":"C:\\Users\\yif_z\\Desktop\\DealViewer\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\yif_z\\Desktop\\DealViewer\\src\\views\\product\\ProductReport.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\yif_z\\Desktop\\DealViewer\\src\\views\\product\\ProductReport.vue","mtime":1604646057905},{"path":"C:\\Users\\yif_z\\Desktop\\DealViewer\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\yif_z\\Desktop\\DealViewer\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\yif_z\\Desktop\\DealViewer\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\Users\\yif_z\\Desktop\\DealViewer\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\yif_z\\Desktop\\DealViewer\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport dataGrid from '@/components/common/DataGrid.vue';\nimport ItemBox from '@/components/layout/ItemBox.vue';\nimport {\n  mapState,\n  mapMutations\n} from 'vuex';\nimport fsvc from \"@/api/FileService\";\nimport csvc from \"@/api/CommonService\";\n\nexport default {\n  components: {\n    dataGrid,\n    ItemBox\n  },\n  data() {\n    return {\n      listOrder: 'ItemId asc,TrustStartDate asc',\n      listFilter: 'IsMarketProduct = 1',\n      searchS: true,\n      industy:'202003季度',\n      createReport:false,\n      fields: [{\n        TrustName:'202001季度'\n      },{\n        TrustName:'202002季度'\n      },{\n        TrustName:'202003季度'\n      },{\n        TrustName:'202004季度'\n      },],\n      checkedData:[],\n      tableDataList:[],\n      viewType: 'DV.view_Products',\n      reportUpload:false,\n      dialogUploadFileName:'',\n      progressSw:false,\n      progressText: '正在保存文件，请稍等',\n      percentage: 0,\n    }\n  },\n  computed: {\n    userName() {\n      return this.$store.state.user.userName;\n    },\n    ConcernTrust() {\n      return this.$store.state.productInfo.ConcernTrust\n    }\n  },\n  methods: {\n    ...mapMutations('productInfo', ['setProductDetail', 'setConcernTrust']),\n    searchSC() {\n      this.searchS = !this.searchS\n    },\n    exportExcel(){\n      this.createReport = true;\n    },\n    EditReport(TrustID){\n      this.reportUpload = true;\n      this.TrustId = TrustID;\n    },\n    downloadReport(TrustId){\n      //下载报告\n      this.$message.success('下载成功');\n    },\n    deleteReport(TrustID){\n      //删除报告\n      let self = this;\n      if (confirm(\"确定要删除所选产品吗?\")) {\n        self.$message.success('删除成功');\n      }\n    },\n    dialogFileInputs(event) {\n      var file = event.target.files;\n      if (file.length == 1) {\n        this.dialogUploadFileName = file[0].name;\n      }\n    },\n    dialogUploadCilck(id) {\n      $(\"#\" + id).click();\n    },\n    reportingFilesUpload() {\n      var self = this;\n      var postData = $(\"#excelUploads\")[0].files;\n      if (postData.length < 1) {\n        self.$message.error('请选择上传的文件');\n        return;\n      }\n\n      self.reportUpload = false;\n      self.percentage = 0\n      var postDataI = 0;\n      var nbprogress = 0;\n      var postDataName = postData[postDataI].name;\n      const progress = function (progressEvt) {\n        self.progressSw = true\n        nbprogress = progressEvt.loaded / progressEvt.total;\n        self.percentage = parseInt((postDataI + nbprogress) / (postData.length) * 100)\n\n      };\n      var callback1 = function (fpath) {\n        self.progressText = ''\n        let filePath = fpath.UploadResult;\n        filePath = filePath.substr(0,filePath.lastIndexOf('/')+1)\n        let fileType = postDataName.substr(postDataName.lastIndexOf(\".\") + 1);\n        var svc = self.$http('PortfolioManagement', 'DV.TrustAssociatedDocs_Add');\n        svc.AddParam({\n          Name: \"TrustId\",\n          Value: self.TrustID,\n          DBType: \"int\"\n        });\n        svc.AddParam({\n          Name: \"FileCategory\",\n          Value: self.fileType,\n          DBType: \"string\"\n        });\n        svc.AddParam({\n          Name: \"FilePath\",\n          Value: filePath,\n          DBType: \"string\"\n        });\n        svc.AddParam({\n          Name: \"FileName\",\n          Value: postDataName,\n          DBType: \"string\"\n        });\n        svc.AddParam({\n          Name: \"FileType\",\n          Value: fileType,\n          DBType: \"string\"\n        });\n        svc.AddParam({\n          Name: \"UserName\",\n          Value: self.userName,\n          DBType: \"string\"\n        });\n        svc.ExecResult().then(res => {\n          res = parseInt(res);\n          if (isNaN(res)) {\n            self.$message.error('文件上传发生内部服务错误');\n            self.progressSw = false\n          } else {\n            self.progressSw = true\n            self.progressText = '已成功上传文件'\n            setTimeout(() => {\n              self.progressSw = false\n              self.progressText = ''\n            }, 500)\n          }\n        });\n      }\n      fsvc.UploadOther(postData[postDataI], postDataName, folderName, 1)(progress, callback1)\n    },\n    row_key(row) {\n      //console.log(row)\n      return this.viewType === 'DV.view_Products' ? row.TrustId : row.SNO;\n    },\n\n    listDataChanged(data) {\n      this.tableDataList = data\n    },\n  },\n  mounted() {\n    this.$title();\n    this.listFilter = \"IsMarketProduct = 1\"\n  }\n}\n\n",null]}