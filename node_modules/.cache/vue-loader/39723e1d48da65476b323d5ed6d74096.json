{"remainingRequest":"C:\\Users\\yif_z\\Desktop\\DealViewer\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\yif_z\\Desktop\\DealViewer\\src\\views\\admin\\ProductInformation.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\yif_z\\Desktop\\DealViewer\\src\\views\\admin\\ProductInformation.vue","mtime":1604281047458},{"path":"C:\\Users\\yif_z\\Desktop\\DealViewer\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\yif_z\\Desktop\\DealViewer\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\Users\\yif_z\\Desktop\\DealViewer\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\yif_z\\Desktop\\DealViewer\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport fsvc from \"@/api/FileService\";\nimport dynamicTab from \"@/mixins/dynamicTab.js\";\nimport Highcharts from \"highcharts\";\nimport TreeMap from \"highcharts/modules/treemap\";\nTreeMap(Highcharts);\n// import Dates from '@/components/product/Dates.vue'\nimport BaseInfo from \"@/components/common/BaseInfo.vue\";\nimport { mapState, mapMutations } from \"vuex\";\nimport { BasePath } from '@/utils/config.js';\nexport default {\n  data() {\n    return {\n      stepTable: [],\n      tableHeight: \"auto\",\n      imgData: \"\",\n      structurePicture: \"\",\n      updateDialog: false,\n      progressSw: false,\n      percentage: 0,\n      progressText: \"正在保存文件，请稍等\",\n      dialogUploadFileName: \"\", //上传文件名\n      PictureType: 0,\n      delFileType: 0,\n      CashFlowPicture: \"\",\n      CashFlowPicture2: \"\"\n    };\n  },\n  created() {\n    this.loadDealStructure();\n  },\n  mixins: [dynamicTab],\n  components: {\n    BaseInfo\n  },\n  computed: {\n    productDetail() {\n      var productDetail = JSON.parse(\n        JSON.stringify(this.$store.state.productInfo.productDetail)\n      );\n\n      Object.keys(productDetail).forEach(key => {\n        if (productDetail[key] == \"\" || !productDetail[key]) {\n          productDetail[key] = \"-\";\n        }\n      });\n      return productDetail;\n    },\n    TrustID() {\n      return this.$store.state.productInfo.trustId;\n    },\n    ...mapState(\"user\", [\"userName\"])\n  },\n  methods: {\n    ...mapMutations(\"dynamicTabs\", [\"setTab\"]),\n    loadDealStructure() {\n      var self = this;\n      var svc = this.$http(\n        \"PortfolioManagement\",\n        \"DV.DealStructurePicture_Get\"\n      );\n      svc.AddParam({ Name: \"TrustID\", Value: self.TrustID, DBType: \"int\" });\n      svc.ExecTable().then(res => {\n        console.log(res);\n        console.log(res[0]);\n        console.log(res[1]);\n        if (res.length > 0) {\n          let fileSource = res[0].FileSource;\n          let strCashFlowPicture = res[0].FileSource2;\n          let strCashFlowPicture2 = res[0].FileSource3;\n          if (fileSource) {\n            fileSource = fileSource.replace(/\\\\/g, \"/\");\n            self.structurePicture = BasePath + \"FileBaseFolder/\" + fileSource;\n          }\n          if (strCashFlowPicture) {\n            strCashFlowPicture = strCashFlowPicture.replace(/\\\\/g, \"/\");\n            self.CashFlowPicture = BasePath + \"FileBaseFolder/\" + strCashFlowPicture;\n          }\n          if (strCashFlowPicture2) {\n            strCashFlowPicture2 = strCashFlowPicture2.replace(/\\\\/g, \"/\");\n            self.CashFlowPicture2 = BasePath + \"FileBaseFolder/\" + strCashFlowPicture2;\n          }\n\n          return;\n        }\n        self.structurePicture = \"\";\n      });\n      self.setTab({\n        id: \"ProductDetail\" + self.TrustID,\n        name: \"ProductInformation\"\n      });\n    },\n    dialogFileInputs(event) {\n      var file = event.target.files;\n      let self = this;\n      if (file.length > 1) {\n        this.dialogUploadFileName = \"\";\n        for (let key in file) {\n          if (key == \"length\") {\n            self.dialogUploadFileName = self.dialogUploadFileName.substring(\n              0,\n              self.dialogUploadFileName.length - 1\n            );\n            return;\n          }\n          self.dialogUploadFileName =\n            self.dialogUploadFileName + file[key].name + \",\";\n        }\n      } else if (file.length == 1) {\n        this.dialogUploadFileName = file[0].name;\n      }\n    },\n    dialogUploadCilck(id) {\n      $(\"#\" + id).click();\n    },\n    dealStructurePictureUpload() {\n      var self = this;\n      var postData = $(\"#excelUploads\")[0].files;\n      if (postData.length < 1) {\n        self.$message.error(\"请选择上传的图片\");\n        return;\n      }\n      self.updateDialog = false;\n      var len = postData.length;\n      var ai = 0;\n      self.percentage = 0;\n      var postDataI = 0;\n      var nbprogress = 0;\n      var postDataName = postData[postDataI].name;\n      var folderName = \"DealViewer\\\\DealStructurePicture\\\\\" + self.TrustID;\n      folderName =\n        this.PictureType == 1\n          ? \"DealViewer\\\\DealStructurePicture\\\\\" + self.TrustID + \"\\\\1\"\n          : folderName;\n      folderName =\n        this.PictureType == 2\n          ? \"DealViewer\\\\DealStructurePicture\\\\\" + self.TrustID + \"\\\\2\"\n          : folderName;\n      const progress = function(progressEvt) {\n        self.progressSw = true;\n        nbprogress = progressEvt.loaded / progressEvt.total;\n        self.percentage = parseInt(\n          ((postDataI + nbprogress) / postData.length) * 100\n        );\n      };\n      var callback1 = function(fpath) {\n        self.progressText = \"\";\n        let filePath = fpath.UploadResult;\n        filePath = filePath.substr(0, filePath.lastIndexOf(\"\\\\\") + 1);\n        console.log(filePath);\n        let fileType = postDataName.substr(postDataName.lastIndexOf(\".\") + 1);\n        var svc = self.$http(\n          \"PortfolioManagement\",\n          \"DV.DealStructurePicture_Add\"\n        );\n        svc.AddParam({\n          Name: \"TrustId\",\n          Value: self.TrustID,\n          DBType: \"int\"\n        });\n        svc.AddParam({\n          Name: \"FilePath\",\n          Value: filePath,\n          DBType: \"string\"\n        });\n        svc.AddParam({\n          Name: \"FileName\",\n          Value: postDataName,\n          DBType: \"string\"\n        });\n        svc.AddParam({\n          Name: \"UserName\",\n          Value: self.userName,\n          DBType: \"string\"\n        });\n        svc.AddParam({\n          Name: \"PictureType\",\n          Value: self.PictureType,\n          DBType: \"string\"\n        });\n        svc.ExecResult().then(res => {\n          res = parseInt(res);\n          if (isNaN(res)) {\n            self.$message.success(\"文件上传成功\");\n            document.location.reload();\n            self.progressSw = false;\n          } else {\n            self.progressSw = true;\n            // self.percentage = parseInt(((postDataI+1)/(postData.length)) * 100)\n            if (postDataI == postData.length - 1) {\n              self.progressText = \"已成功上传\" + (postDataI + 1) + \"个文件\";\n              setTimeout(() => {\n                self.progressSw = false;\n                self.progressText = \"\";\n              }, 500);\n            }\n            postDataI++;\n            if (postDataI < postData.length) {\n              postDataName = postData[postDataI].name;\n              fsvc.UploadOther(\n                postData[postDataI],\n                postDataName,\n                folderName\n              )(progress, callback1);\n            }\n            self.loadDealStructure();\n          }\n        });\n      };\n      var svc = self.$http(\n        \"PortfolioManagement\",\n        \"DV.DealStructurePicture_Remove\"\n      );\n      svc.AddParam({\n        Name: \"TrustID\",\n        Value: self.TrustID,\n        DBType: \"int\"\n      });\n      svc.AddParam({\n        Name: \"UserName\",\n        Value: self.userName,\n        DBType: \"string\"\n      });\n      svc.AddParam({\n        Name: \"PictureType\",\n        Value: self.PictureType,\n        DBType: \"string\"\n      });\n      svc.ExecResult().then(res => {\n        if (isNaN(res)) {\n          //self.$message.error('文件上传发生内部服务错误');\n          self.$message.success(\"文件上传成功\");\n          document.location.reload();\n        } else {\n          //删除物理文件\n          if (self.structurePicture) {\n            fsvc.Remove(self.structurePicture, 0);\n          }\n\n          fsvc.UploadOther(\n            postData[postDataI],\n            postDataName,\n            folderName\n          )(progress, callback1);\n        }\n      });\n    },\n    deleteFile(ParamType) {\n      var self = this;\n      this.$confirm(\"图片将被删除,是否继续？\", \"提示\", {\n        confirmButtonText: \"确定\",\n        cancelButttonText: \"取消\",\n        type: \"warning\"\n      })\n        .then(() => {\n          var svc = self.$http(\n            \"PortfolioManagement\",\n            \"DV.DealStructurePicture_Remove\"\n          );\n          svc.AddParam({\n            Name: \"TrustID\",\n            Value: self.TrustID,\n            DBType: \"int\"\n          });\n          svc.AddParam({\n            Name: \"UserName\",\n            Value: self.userName,\n            DBType: \"string\"\n          });\n          svc.AddParam({\n            Name: \"PictureType\",\n            Value: ParamType,\n            DBType: \"string\"\n          });\n          svc.ExecResult().then(res => {\n            if (isNaN(res)) {\n              self.$message.error(\"文件删除请求发生错误\");\n            } else {\n              self.$message.success(\"文件删除成功\");\n              //删除物理文件\n              if (self.structurePicture) {\n                fsvc.Remove(self.structurePicture, 0);\n              }\n              self.loadDealStructure();\n            }\n          });\n        })\n        .catch(() => {});\n    },\n    clickupdateDialog() {\n      this.PictureType = 1;\n      this.updateDialog = true;\n    },\n    clickupdateDialog2() {\n      this.PictureType = 2;\n      this.updateDialog = true;\n    }\n  },\n  watch: {}\n};\n",{"version":3,"sources":["ProductInformation.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"ProductInformation.vue","sourceRoot":"src/views/admin","sourcesContent":["<template>\n  <div class=\"productInformation detailPage\">\n    <div class=\"itemBox\">\n      <div class=\"table-title\">基本信息</div>\n      <div class=\"content\">\n        <el-row :gutter=\"20\">\n          <el-col :span=\"24\">\n            <BaseInfo :line=\"2\">\n              <li>\n                <span>产品名称</span>\n                <span>{{productDetail.TrustName}}</span>\n              </li>\n              <li>\n                <span>发行金额</span>\n                <span\n                  class=\"moneyMark\"\n                >{{productDetail.IssueAmount?productDetail.IssueAmount.toLocaleString():productDetail.IssueAmount}}</span>\n              </li>\n              <li>\n                <span>产品代码</span>\n                <span>{{productDetail.TrustCode}}</span>\n              </li>\n              <li>\n                <span>市场分类</span>\n                <span>{{productDetail.MarketCategoryName}}</span>\n              </li>\n              <li>\n                <span>发行时间</span>\n                <span class=\"otherMark\">{{productDetail.TrustStartDate}}</span>\n              </li>\n              <li>\n                <span>交易场所</span>\n                <span>{{productDetail.MarketPlaceName}}</span>\n              </li>\n              <li>\n                <span>资产类型</span>\n                <span>{{productDetail.AssetTypeName}}</span>\n              </li>\n              <li>\n                <span>监管机构</span>\n                <span>{{productDetail.RegulatoryOrgName}}</span>\n              </li>\n              <li>\n                <span>基本资产</span>\n                <span>{{productDetail.BasicAssetTypeName}}</span>\n              </li>\n              <li>\n                <span>发行方式</span>\n                <span>{{productDetail.CollectionMethodName}}</span>\n              </li>\n            </BaseInfo>\n          </el-col>\n        </el-row>\n      </div>\n    </div>\n    <div class=\"itemBox\">\n      <div>\n        <div style=\"float:right;margin-left: 10px;\">\n          <el-button type=\"primary\" size=\"mini\" @click=\"deleteFile(0)\">\n            <span class=\"iconfont icon-delete\"></span>删除图片\n          </el-button>\n        </div>\n        <div style=\"float:right;\">\n          <el-button type=\"primary\" size=\"mini\" @click=\"updateDialog = true\">\n            <span class=\"iconfont icon-upload1\"></span>上传图片\n          </el-button>\n        </div>\n\n        <div class=\"table-title\">交易结构</div>\n      </div>\n\n      <div class=\"content\" style=\"text-align:center;\">\n        <img :src=\"structurePicture\" style=\"width:60%;\" />\n        <p v-if=\"!structurePicture\" class=\"noData\">暂无数据</p>\n      </div>\n    </div>\n    <div class=\"itemBox\">\n      <div>\n        <div style=\"float:right;margin-left: 10px;\">\n          <el-button type=\"primary\" size=\"mini\" @click=\"deleteFile(1)\">\n            <span class=\"iconfont icon-delete\"></span>删除图片\n          </el-button>\n        </div>\n        <div style=\"float:right;\">\n          <el-button type=\"primary\" size=\"mini\" @click=\"clickupdateDialog()\">\n            <span class=\"iconfont icon-upload1\"></span>上传图片\n          </el-button>\n        </div>\n\n        <div class=\"table-title\">现金流分配顺序图——违约前</div>\n      </div>\n\n      <div class=\"content\" style=\"text-align:center;\">\n        <img :src=\"CashFlowPicture\" style=\"width:60%;\" />\n        <p v-if=\"!CashFlowPicture\" class=\"noData\">暂无数据</p>\n      </div>\n    </div>\n    <div class=\"itemBox\">\n      <div>\n        <div style=\"float:right;margin-left: 10px;\">\n          <el-button type=\"primary\" size=\"mini\" @click=\"deleteFile(2)\">\n            <span class=\"iconfont icon-delete\"></span>删除图片\n          </el-button>\n        </div>\n        <div style=\"float:right;\">\n          <el-button type=\"primary\" size=\"mini\" @click=\"clickupdateDialog2()\">\n            <span class=\"iconfont icon-upload1\"></span>上传图片\n          </el-button>\n        </div>\n\n        <div class=\"table-title\">现金流分配顺序图——违约后</div>\n      </div>\n\n      <div class=\"content\" style=\"text-align:center;\">\n        <img :src=\"CashFlowPicture2\" style=\"width:60%;\" />\n        <p v-if=\"!CashFlowPicture2\" class=\"noData\">暂无数据</p>\n      </div>\n    </div>\n    <base-dialog\n      :close-on-click-modal=\"false\"\n      title=\"上传文件\"\n      :visible.sync=\"updateDialog\"\n      width=\"500px\"\n      draggable\n    >\n      <div style=\"margin:20px 0;\">\n        <el-form ref=\"form\" autocomplete=\"off\" label-width=\"100px\" v-if=\"updateDialog\">\n          <el-form-item label=\"文件上传\">\n            <div class=\"dialogfileUploadBox\" style=\"margin:0;text-align:left;\">\n              <input\n                type=\"file\"\n                id=\"excelUploads\"\n                @change=\"dialogFileInputs($event)\"\n                class=\"fileUploadInput\"\n                accept=\"image/*\"\n              />\n              <el-input class=\"el_fileUploadInput\" v-model=\"dialogUploadFileName\" key=\"02\">\n                <el-button\n                  class=\"el_fileUploadBtn\"\n                  slot=\"append\"\n                  @click=\"dialogUploadCilck('excelUploads')\"\n                >选择文件</el-button>\n              </el-input>\n            </div>\n          </el-form-item>\n        </el-form>\n      </div>\n      <p style=\"text-align:center\">\n        <el-button @click=\"updateDialog = false\">取消</el-button>\n        <el-button type=\"primary\" @click=\"dealStructurePictureUpload()\" size=\"mini\">确定上传</el-button>\n      </p>\n    </base-dialog>\n    <!-- 进度条 -->\n    <div class=\"progressOut\" v-if=\"progressSw\">\n      <el-progress type=\"circle\" :percentage=\"percentage\" color=\"#8e71c7\" :width=\"90\"></el-progress>\n      <p\n        style=\"color:#333;position: absolute;top: 50%;width: 100%;text-align: center;font-size: 13px;margin-top:50px;\"\n      >{{progressText}}</p>\n    </div>\n  </div>\n</template>\n\n<script>\nimport fsvc from \"@/api/FileService\";\nimport dynamicTab from \"@/mixins/dynamicTab.js\";\nimport Highcharts from \"highcharts\";\nimport TreeMap from \"highcharts/modules/treemap\";\nTreeMap(Highcharts);\n// import Dates from '@/components/product/Dates.vue'\nimport BaseInfo from \"@/components/common/BaseInfo.vue\";\nimport { mapState, mapMutations } from \"vuex\";\nimport { BasePath } from '@/utils/config.js';\nexport default {\n  data() {\n    return {\n      stepTable: [],\n      tableHeight: \"auto\",\n      imgData: \"\",\n      structurePicture: \"\",\n      updateDialog: false,\n      progressSw: false,\n      percentage: 0,\n      progressText: \"正在保存文件，请稍等\",\n      dialogUploadFileName: \"\", //上传文件名\n      PictureType: 0,\n      delFileType: 0,\n      CashFlowPicture: \"\",\n      CashFlowPicture2: \"\"\n    };\n  },\n  created() {\n    this.loadDealStructure();\n  },\n  mixins: [dynamicTab],\n  components: {\n    BaseInfo\n  },\n  computed: {\n    productDetail() {\n      var productDetail = JSON.parse(\n        JSON.stringify(this.$store.state.productInfo.productDetail)\n      );\n\n      Object.keys(productDetail).forEach(key => {\n        if (productDetail[key] == \"\" || !productDetail[key]) {\n          productDetail[key] = \"-\";\n        }\n      });\n      return productDetail;\n    },\n    TrustID() {\n      return this.$store.state.productInfo.trustId;\n    },\n    ...mapState(\"user\", [\"userName\"])\n  },\n  methods: {\n    ...mapMutations(\"dynamicTabs\", [\"setTab\"]),\n    loadDealStructure() {\n      var self = this;\n      var svc = this.$http(\n        \"PortfolioManagement\",\n        \"DV.DealStructurePicture_Get\"\n      );\n      svc.AddParam({ Name: \"TrustID\", Value: self.TrustID, DBType: \"int\" });\n      svc.ExecTable().then(res => {\n        console.log(res);\n        console.log(res[0]);\n        console.log(res[1]);\n        if (res.length > 0) {\n          let fileSource = res[0].FileSource;\n          let strCashFlowPicture = res[0].FileSource2;\n          let strCashFlowPicture2 = res[0].FileSource3;\n          if (fileSource) {\n            fileSource = fileSource.replace(/\\\\/g, \"/\");\n            self.structurePicture = BasePath + \"FileBaseFolder/\" + fileSource;\n          }\n          if (strCashFlowPicture) {\n            strCashFlowPicture = strCashFlowPicture.replace(/\\\\/g, \"/\");\n            self.CashFlowPicture = BasePath + \"FileBaseFolder/\" + strCashFlowPicture;\n          }\n          if (strCashFlowPicture2) {\n            strCashFlowPicture2 = strCashFlowPicture2.replace(/\\\\/g, \"/\");\n            self.CashFlowPicture2 = BasePath + \"FileBaseFolder/\" + strCashFlowPicture2;\n          }\n\n          return;\n        }\n        self.structurePicture = \"\";\n      });\n      self.setTab({\n        id: \"ProductDetail\" + self.TrustID,\n        name: \"ProductInformation\"\n      });\n    },\n    dialogFileInputs(event) {\n      var file = event.target.files;\n      let self = this;\n      if (file.length > 1) {\n        this.dialogUploadFileName = \"\";\n        for (let key in file) {\n          if (key == \"length\") {\n            self.dialogUploadFileName = self.dialogUploadFileName.substring(\n              0,\n              self.dialogUploadFileName.length - 1\n            );\n            return;\n          }\n          self.dialogUploadFileName =\n            self.dialogUploadFileName + file[key].name + \",\";\n        }\n      } else if (file.length == 1) {\n        this.dialogUploadFileName = file[0].name;\n      }\n    },\n    dialogUploadCilck(id) {\n      $(\"#\" + id).click();\n    },\n    dealStructurePictureUpload() {\n      var self = this;\n      var postData = $(\"#excelUploads\")[0].files;\n      if (postData.length < 1) {\n        self.$message.error(\"请选择上传的图片\");\n        return;\n      }\n      self.updateDialog = false;\n      var len = postData.length;\n      var ai = 0;\n      self.percentage = 0;\n      var postDataI = 0;\n      var nbprogress = 0;\n      var postDataName = postData[postDataI].name;\n      var folderName = \"DealViewer\\\\DealStructurePicture\\\\\" + self.TrustID;\n      folderName =\n        this.PictureType == 1\n          ? \"DealViewer\\\\DealStructurePicture\\\\\" + self.TrustID + \"\\\\1\"\n          : folderName;\n      folderName =\n        this.PictureType == 2\n          ? \"DealViewer\\\\DealStructurePicture\\\\\" + self.TrustID + \"\\\\2\"\n          : folderName;\n      const progress = function(progressEvt) {\n        self.progressSw = true;\n        nbprogress = progressEvt.loaded / progressEvt.total;\n        self.percentage = parseInt(\n          ((postDataI + nbprogress) / postData.length) * 100\n        );\n      };\n      var callback1 = function(fpath) {\n        self.progressText = \"\";\n        let filePath = fpath.UploadResult;\n        filePath = filePath.substr(0, filePath.lastIndexOf(\"\\\\\") + 1);\n        console.log(filePath);\n        let fileType = postDataName.substr(postDataName.lastIndexOf(\".\") + 1);\n        var svc = self.$http(\n          \"PortfolioManagement\",\n          \"DV.DealStructurePicture_Add\"\n        );\n        svc.AddParam({\n          Name: \"TrustId\",\n          Value: self.TrustID,\n          DBType: \"int\"\n        });\n        svc.AddParam({\n          Name: \"FilePath\",\n          Value: filePath,\n          DBType: \"string\"\n        });\n        svc.AddParam({\n          Name: \"FileName\",\n          Value: postDataName,\n          DBType: \"string\"\n        });\n        svc.AddParam({\n          Name: \"UserName\",\n          Value: self.userName,\n          DBType: \"string\"\n        });\n        svc.AddParam({\n          Name: \"PictureType\",\n          Value: self.PictureType,\n          DBType: \"string\"\n        });\n        svc.ExecResult().then(res => {\n          res = parseInt(res);\n          if (isNaN(res)) {\n            self.$message.success(\"文件上传成功\");\n            document.location.reload();\n            self.progressSw = false;\n          } else {\n            self.progressSw = true;\n            // self.percentage = parseInt(((postDataI+1)/(postData.length)) * 100)\n            if (postDataI == postData.length - 1) {\n              self.progressText = \"已成功上传\" + (postDataI + 1) + \"个文件\";\n              setTimeout(() => {\n                self.progressSw = false;\n                self.progressText = \"\";\n              }, 500);\n            }\n            postDataI++;\n            if (postDataI < postData.length) {\n              postDataName = postData[postDataI].name;\n              fsvc.UploadOther(\n                postData[postDataI],\n                postDataName,\n                folderName\n              )(progress, callback1);\n            }\n            self.loadDealStructure();\n          }\n        });\n      };\n      var svc = self.$http(\n        \"PortfolioManagement\",\n        \"DV.DealStructurePicture_Remove\"\n      );\n      svc.AddParam({\n        Name: \"TrustID\",\n        Value: self.TrustID,\n        DBType: \"int\"\n      });\n      svc.AddParam({\n        Name: \"UserName\",\n        Value: self.userName,\n        DBType: \"string\"\n      });\n      svc.AddParam({\n        Name: \"PictureType\",\n        Value: self.PictureType,\n        DBType: \"string\"\n      });\n      svc.ExecResult().then(res => {\n        if (isNaN(res)) {\n          //self.$message.error('文件上传发生内部服务错误');\n          self.$message.success(\"文件上传成功\");\n          document.location.reload();\n        } else {\n          //删除物理文件\n          if (self.structurePicture) {\n            fsvc.Remove(self.structurePicture, 0);\n          }\n\n          fsvc.UploadOther(\n            postData[postDataI],\n            postDataName,\n            folderName\n          )(progress, callback1);\n        }\n      });\n    },\n    deleteFile(ParamType) {\n      var self = this;\n      this.$confirm(\"图片将被删除,是否继续？\", \"提示\", {\n        confirmButtonText: \"确定\",\n        cancelButttonText: \"取消\",\n        type: \"warning\"\n      })\n        .then(() => {\n          var svc = self.$http(\n            \"PortfolioManagement\",\n            \"DV.DealStructurePicture_Remove\"\n          );\n          svc.AddParam({\n            Name: \"TrustID\",\n            Value: self.TrustID,\n            DBType: \"int\"\n          });\n          svc.AddParam({\n            Name: \"UserName\",\n            Value: self.userName,\n            DBType: \"string\"\n          });\n          svc.AddParam({\n            Name: \"PictureType\",\n            Value: ParamType,\n            DBType: \"string\"\n          });\n          svc.ExecResult().then(res => {\n            if (isNaN(res)) {\n              self.$message.error(\"文件删除请求发生错误\");\n            } else {\n              self.$message.success(\"文件删除成功\");\n              //删除物理文件\n              if (self.structurePicture) {\n                fsvc.Remove(self.structurePicture, 0);\n              }\n              self.loadDealStructure();\n            }\n          });\n        })\n        .catch(() => {});\n    },\n    clickupdateDialog() {\n      this.PictureType = 1;\n      this.updateDialog = true;\n    },\n    clickupdateDialog2() {\n      this.PictureType = 2;\n      this.updateDialog = true;\n    }\n  },\n  watch: {}\n};\n</script>\n\n<style lang=\"scss\">\n.productInformation {\n  padding-top: 0;\n  .itemBox {\n    margin-bottom: 20px;\n    padding: 15px;\n    background-color: #fff;\n    p {\n      line-height: 30px;\n      span {\n        margin-right: 20px;\n        color: $--color-grey;\n      }\n    }\n    .content {\n      padding: 0 10px;\n    }\n    .moneyMark {\n      color: $--color-orange;\n      font-size: 15px;\n      font-weight: bold;\n    }\n    .otherMark {\n      font-size: 15px;\n      color: $--color-primary;\n      font-weight: bold;\n    }\n  }\n  .dialogfileUploadBox .el_fileUploadInput {\n    left: 0;\n    width: 300px;\n  }\n  .progressOut {\n    background-color: rgba(255, 255, 255, 0.7);\n    text-align: center;\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100vw;\n    height: 100vh;\n    z-index: 999;\n    .el-progress--circle {\n      top: 50%;\n      margin-top: -45px;\n      position: absolute;\n      left: 50%;\n      margin-left: -45px;\n    }\n  }\n}\n</style>\n"]}]}